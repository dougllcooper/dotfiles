import{r as A,j as h,a as e,f as K,p as Y,i as rt,d,L as Ft,l as re,b as ee,e as jt,c as Wt,g as ot,s as $t,h as Z,P as st,F as ue,k as M,B as G,S as F,A as Ne,m as Te,I as qe,n as Me,R as Ut,u as j,o as b,M as ie,q as z,D as lt,t as H,C as Ie,v as Yt,T as me,w as Gt,x as zt,y as Qt,z as Vt,E as Kt,G as Zt,H as Xt,J as it,K as Ee,N as Jt,O as _e,Q as Be,U as ea,V as ta,W as aa,X as na,Y as ra,Z as Oe,_ as Le,$ as oa,a0 as sa,a1 as la,a2 as ia,a3 as ca,a4 as da,a5 as ua,a6 as ma,a7 as pa,a8 as ct,a9 as Pe,aa as ha,ab as ga,ac as fa,ad as ya,ae as wa,af as ka,ag as ba,ah as xa,ai as Re,aj as dt,ak as va,al as Ca,am as Aa,an as Da,ao as Sa,ap as Na,aq as Ta}from"./vendor.4c90bbdb.js";const qa=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}};qa();const oe="yyyy-MM-dd",ut="yyyy-MM-dd EEE",Ma="Daily Log",pe=/^((?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])(-(?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])*/,mt=[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"2week",label:"2 Weeks"},{value:"month",label:"Monthly"}],Ia=[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"auto",label:"Auto"}],Ea=[{value:"green",label:"Green"},{value:"purple",label:"Purple"}],$={theme:"auto",lightThemeType:"green",homePage:"dashboard",defaultView:"month",weekStartDay:0,weekHourStart:0,weekHourEnd:24,defaultDuration:{value:.5,unit:"h"},logKey:{id:Ma,bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0},calendarList:[{id:"journal",bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
  :where
  [?block :block/marker ?marker]
  [(missing? $ ?block :block/deadline)]
  (not [(missing? $ ?block :block/scheduled)])
  [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
          `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull ?block [*])
  :where
  [?block :block/marker ?marker]
  [(missing? $ ?block :block/scheduled)]
  (not [(missing? $ ?block :block/deadline)])
  [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
          `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull
  ?block
  [:block/uuid
    :db/id
    :block/parent
    :block/left
    :block/collapsed?
    :block/format
    :block/_refs
    :block/path-refs
    :block/tags
    :block/content
    :block/marker
    :block/priority
    :block/properties
    :block/pre-block?
    :block/scheduled
    :block/deadline
    :block/repeated?
    :block/created-at
    :block/updated-at
    :block/file
    :block/heading-level
    {:block/page
    [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}])
  :where
  [?block :block/page ?page]
  [?page :block/journal? true]
  [?block :block/marker ?marker]
  [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]
  [(missing? $ ?block :block/scheduled)]
  [(missing? $ ?block :block/deadline)]]
          `,scheduleStart:"page.journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull ?block [*])
  :where
  [?rp :block/name "milestone"]
  [?block :block/refs ?rp]]
          `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0,queryType:"advanced"}]}],subscriptionList:[]},_a={light:{"month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#fafafa","month.day.fontSize":"16px","week.daygrid.borderRight":"1px solid #ddd","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"#a8def74d","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #ddd","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#fafafa","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"#03a9f44d","week.timegridLeft.borderRight":"1px solid #ddd","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #f9f9f9","week.timegridHorizontalLine.borderBottom":"1px solid #eee","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #ddd","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#135de6","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#808080","week.pastTime.fontWeight":"normal","week.futureTime.color":"#333","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(19, 93, 230, 0.3)","week.currentTimeLineBullet.backgroundColor":"#135de6","week.currentTimeLineToday.border":"1px solid #135de6","week.currentTimeLineFuture.border":"1px solid #135de6"},dark:{"common.backgroundColor":"#32373d","common.saturday.color":"#babec4","common.dayname.color":"#babec4","common.border":"1px solid #58595c","common.creationGuide.backgroundColor":"#32373d","month.dayname.borderLeft":"1px solid #58595c","month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#282c31","month.day.fontSize":"16px","week.vpanelSplitter.border":"1px solid #58595c","week.today.color":"#fff","week.pastDay.color":"#8f9296","week.dayname.borderTop":"1px solid #58595c","week.dayname.borderBottom":"1px solid #58595c","week.daygrid.borderRight":"1px solid #58595c","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"rgba(252, 183, 20, 0.3)","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #58595c","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#282c31","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"rgba(252, 183, 20, 0.4)","week.timegridLeft.borderRight":"1px solid #58595c","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #3d3e40","week.timegridHorizontalLine.borderBottom":"1px solid #58595c","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #58595c","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#fcb714","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#bababd","week.pastTime.fontWeight":"normal","week.futureTime.color":"#dadade","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(252, 183, 20, 0.4)","week.currentTimeLineBullet.backgroundColor":"#fcb714","week.currentTimeLineToday.border":"1px solid #fcb714","week.currentTimeLineFuture.border":"1px solid #fcb714"}},pt="yyyyMMdd",Ba=[{value:"m",label:"minute"},{value:"h",label:"hour"}],ht="Agenda",Q=()=>{let t=$.logKey;const a=logseq.settings?.logKey;return a&&(t=a,typeof a=="string"&&$.logKey&&(t={...$.logKey,id:a})),{...$,...logseq.settings,logKey:t}},Oa=()=>{if(!logseq.settings?.initialized){const a=Q();logseq.updateSettings({...a,initialized:!0}),console.log("[faiz:] === initialize settings success",logseq.settings)}},La=async()=>{const t=await logseq.App.getStateFromStore("ui/theme");let a=logseq.settings?.defaultView||"month";return logseq.settings?.defaultView==="2week"&&(a="month"),{defaultView:a,taskView:!0,scheduleView:!0,useDetailPopup:!0,isReadOnly:!1,disableClick:!0,theme:_a[t],usageStatistics:!1,week:{startDayOfWeek:logseq.settings?.weekStartDay||0,hourStart:logseq.settings?.weekHourStart||0,hourEnd:logseq.settings?.weekHourEnd||24},month:{startDayOfWeek:logseq.settings?.weekStartDay||0,scheduleFilter:n=>Boolean(n.isVisible),visibleWeeksCount:logseq.settings?.defaultView==="2week"?2:void 0},template:{taskTitle:()=>'<span class="tui-full-calendar-left-content">Overdue</span>',task:n=>"\u{1F525}"+n.title,timegridDisplayPrimayTime:function(n){return n.hour<10?"0"+n.hour+":00":n.hour+":00"},popupDetailBody:n=>{const r=`<br/><b>Calendar: ${n.calendarId}</b>`,o=n.raw?.subscription?"":'<br/><a id="faiz-nav-detail" href="javascript:void(0);">Navigate To Block</a>';return`
          <div class="calendar-popup-detail-content">
            ${n.body?.split(`
`).join("<br/>")}
          </div>
          ${r}
          ${o}
        `}}}},Pa=t=>({id:t,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${t}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
[(get-else $ ?block :block/deadline "nil") ?d]
[(not= ?d "nil")]
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${t}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${t}"} ?pname)]
[?rp :block/name "milestone"]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0}]}),Ra=t=>({id:t,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`(and (page "${t}") (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd",queryType:"simple"},{script:`(and (page "${t}") (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd HH:mm",queryType:"simple"},{script:`(and (page "${t}") [[milestone]] (property start))`,scheduleStart:"properties.start",dateFormatter:"yyyy-MM-dd",queryType:"simple",isMilestone:!0}]});var Ha="data:image/png;base64,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";const Fa="_container_1xwon_1",ja="_buttonWrapper_1xwon_4",Wa="_button_1xwon_4",$a="_active_1xwon_19",Ua="_indicatorBack_1xwon_23",Ya="_indicatorDot_1xwon_34";var ce={container:Fa,buttonWrapper:ja,button:Wa,active:$a,indicatorBack:Ua,indicatorDot:Ya};const Ga=({initialValue:t,onChange:a,tabs:n})=>{const[r,o]=A.exports.useState(t||n?.[0]?.value),s=n.findIndex(({value:l})=>l===r)*100,i=l=>{o(l),a?.(l)};return h("div",{className:ce.container,children:[n.map(({label:l,value:m,icon:c})=>e("div",{className:ce.buttonWrapper,onClick:()=>i(m),children:e("div",{className:`${ce.button} ${m===r?ce.active:""}`,title:l,children:c})},m)),e("div",{className:ce.indicatorBack,style:{transform:`translateX(60px) translateY(${s}%)`}}),e("div",{className:ce.indicatorDot,style:{transform:`translateY(${s}%)`}})]})},he=async(t,a,n)=>{const r=await logseq.Editor.getBlock(t);if(!r)return logseq.App.showMsg("Block not found","error"),Promise.reject(new Error("Block not found"));a&&await logseq.Editor.updateBlock(r.uuid,a);const o=Object.keys(n||{}).map(s=>logseq.Editor.upsertBlockProperty(r.uuid,s,n?.[s]));return Promise.allSettled(o)},gt=async(t,a)=>{const n=await se({id:t});if(!n)return logseq.App.showMsg("moveBlockToNewPage: Block not found","error");const r=await logseq.Editor.createPage(a);return r?(await logseq.Editor.moveBlock(n.uuid,r.uuid),await se({uuid:n.uuid})):logseq.App.showMsg("Create page failed","error")},He=async(t,a,n)=>{const r=await se({id:t});if(!r)return logseq.App.showMsg("moveBlockToSpecificBlock: Block not found","error");let o=await te({originalName:a});o||(o=await logseq.Editor.createPage(a));let s=await yt(a,n);return s||(s=await logseq.Editor.insertBlock(a,n,{before:!0,isPageBlock:!0})),s&&await logseq.Editor.moveBlock(r.uuid,s.uuid,{children:!0}),await se({uuid:r.uuid})},ft=async(t,a,n,r={})=>{let o=await te({originalName:t});o||(o=await logseq.Editor.createPage(t));let s=await yt(t,a);return s||(s=await logseq.Editor.insertBlock(t,a,{before:!0,isPageBlock:!0})),s?await logseq.Editor.insertBlock(s.uuid,n,{isPageBlock:!1,properties:r,sibling:!1,before:!1}):null},ke=new Map,se=async(t,a=!1)=>{const{id:n,uuid:r}=t,o=n||r;if(!o)return Promise.reject(new Error("getBlockData: id or uuid is required"));if(a&&ke.has(o))return ke.get(o);const s=await logseq.Editor.getBlock(o);if(!s)return null;const{id:i,uuid:l}=s;return ke.set(i,s),ke.set(l,s),s},ge=new Map,te=async(t,a,n=!1)=>{const{id:r,uuid:o,originalName:s}=t,i=r||o||s;if(!i)return Promise.reject(new Error("getPageData: id, uuid or pageOriginalName is required"));if(n&&ge.has(i))return ge.get(i);const l=await logseq.Editor.getPage(i,a);if(!l)return null;const{id:m,uuid:c,originalName:y}=l;return ge.set(m,l),ge.set(c,l),ge.set(y,l),l},za=async()=>{const t=await logseq.App.getStateFromStore("ui/theme"),a=logseq.settings?.theme==="auto"?t:logseq.settings?.theme,n=logseq.settings?.lightThemeType||"green";return a==="dark"?"dark":n},yt=async(t,a)=>{const n=await logseq.Editor.getPageBlocksTree(t),r=n.find(o=>o.content===a)||null;return console.log("[faiz:] === getSpecificBlockByContent xxx",n,r),r};function fe(){const[t,a]=A.exports.useState($.lightThemeType);return A.exports.useEffect(()=>{za().then(n=>{console.log("[faiz:] === getCurrentTheme",n),a(n)})}),t}const Qa={green:{lineColor:"#058f68",backColor:"rgba(5, 143, 104, 0.8)",backColorEnd:"rgba(255,255,255,0)"},purple:{lineColor:"#3a4de9",backColor:"rgba(58,77,233,0.8)",backColorEnd:"rgba(255,255,255,0)"},dark:{lineColor:"#d19811",backColor:"rgba(148, 108, 12, 0.8)",backColorEnd:"rgba(33, 37, 40, 0.8)"}},Va={green:{backColor:"#e9f2f0",lineColor:"#058f68",shadowColor:"rgba(5, 143, 104, 0.8)",colorPrimary:"#333",colorSecondary:"#777"},purple:{backColor:"#f2f6ff",lineColor:"#5146a0",shadowColor:"rgba(58,77,233,0.8)",colorPrimary:"#333",colorSecondary:"#777"},dark:{backColor:"#212528",lineColor:"#d19811",shadowColor:"rgba(33, 37, 40, 0.8)",colorPrimary:"#fafafe",colorSecondary:"#aaadb3"}},Ka=async(t,a)=>{const n=logseq.settings?.logKey?.id||$.logKey?.id,{preferredDateFormat:r}=await logseq.App.getUserConfigs(),o=r||ut,s=K(Y(t,oe,new Date),o),i=K(Y(a,oe,new Date),o);return(await logseq.DB.q(`(and [[${n}]] (between [[${s}]] [[${i}]]))`))?.filter(c=>c.content?.trim()===`[[${n}]]`)?.map(c=>Array.isArray(c.parent)?c.parent:[])?.flat()?.filter(c=>(c.content?.trim()).length>0)},Fe=(t,a="blue")=>console.log(`%c${t}`,`color:${a}`),be=t=>{const a=document.querySelector("html"),n=logseq.settings?.lightThemeType||$.lightThemeType,r=n==="green"?"purple":"green";t==="dark"?(a?.classList.add("dark"),a?.classList.remove(n),bt("./antd.dark.min.css")):(a?.classList.remove("dark",r),a?.classList.add(n),bt("./antd.min.css"))},wt=async()=>{const{theme:t}=logseq.settings;if(t==="dark")return be("dark");if(t==="light")return be("light");const a=await logseq.App.getStateFromStore("ui/theme");be(a)},Za=t=>{const a=document.createElement("textarea");a.value=t,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)},kt=t=>{document.addEventListener("keyup",a=>{a.key==="Escape"&&t()})},Xa=()=>{const t=navigator.userAgent,a=t.indexOf("Windows")>-1,n=t.indexOf("Macintosh")>-1,r=t.indexOf("Linux")>-1;return a?"windows":n?"mac":r?"linux":"unknown"};let je=null;const bt=t=>{const a=document.createElement("link");a.rel="stylesheet",a.href=t;const n=document.head||document.getElementsByTagName("head")[0],r=n.childNodes[0];r?n.insertBefore(a,r):n.appendChild(a),je&&n.removeChild(je),je=a},xt=t=>{const a=document.querySelector("html"),n=document.querySelector("body");t?(a?.classList.add("modal-app"),n?.classList.add("modal-app")):(a?.classList.remove("modal-app"),n?.classList.remove("modal-app"))},Ja=Xa(),vt=({progress:t=0,uniqueId:a="",height:n=160,type:r="primary"})=>{const o=A.exports.useRef(),s=fe();return A.exports.useEffect(()=>{const i=document.getElementById("gauge"+a);async function l(){if(!i||!s)return;const m=Va[s],c=r==="normal"?20:60,y=r==="normal"?4:7,k={series:[{type:"gauge",startAngle:90,endAngle:-270,min:0,max:100,splitNumber:12,grid:{left:"0",right:"0",bottom:"0",containLabel:!0},itemStyle:{color:m.lineColor,shadowColor:m.shadowColor,shadowBlur:r==="normal"?3:10,shadowOffsetX:r==="normal"?0:2,shadowOffsetY:r==="normal"?0:2},progress:{show:!0,roundCap:!0,width:y},pointer:{show:!1},axisLine:{roundCap:!0,lineStyle:{width:y,color:[[1,m.backColor]]}},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},title:{show:!1},detail:{show:!0,width:c,height:c,lineHeight:c+(Ja==="windows"?4:0),borderRadius:100,offsetCenter:[0,0],valueAnimation:!0,formatter:function(w){return"{value|"+w.toFixed(0)+"}{unit|%}"},rich:{value:{fontSize:r==="normal"?15:34,color:m.colorPrimary},unit:{fontSize:r==="normal"?10:15,color:m.colorSecondary,padding:r==="normal"?[0,0,-2,1]:[0,0,-8,2]}}},data:[{value:t}]}]};window.requestAnimationFrame(()=>{const w=rt(i);o.current=w,w.setOption(k)})}return l(),()=>{o.current&&o.current.dispose()}},[t,s]),e("div",{children:e("div",{id:"gauge"+a,style:{width:"100%",height:n+"px"}})})},en=({data:t})=>{const a=A.exports.useRef(),n=fe();return console.log("[faiz:] === Polygonal theme",n),A.exports.useEffect(()=>{const r=document.getElementById("polygonal");async function o(){if(!r||!n)return;const s=Qa[n],i={xAxis:{type:"category",data:t.map(l=>{const m=d(l.date).format("DD");return m==="01"?d(l.date).format("MM.DD"):m}),axisTick:{show:!1},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{show:!1},minInterval:1},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},series:[{data:t.map(l=>l.value),type:"line",smooth:!0,emphasis:{focus:"series"},showSymbol:!1,itemStyle:{color:s.lineColor},areaStyle:{color:new Ft(0,0,0,1,[{offset:0,color:s.backColor},{offset:1,color:s.backColorEnd}])}}]};window.requestAnimationFrame(()=>{const l=rt(r);a.current=l,l.setOption(i)})}return o(),()=>{a.current&&a.current.dispose()}},[t,n]),e("div",{id:"polygonal",style:{height:"240px",width:"100%"}})},xe=async()=>{const a=(await St()).map(g=>g.id);let n=[];const r=Q(),{calendarList:o=[],logKey:s,defaultDuration:i,subscriptionList:l}=r,m=o.filter(g=>g?.enabled);let c=[];c=m.map(g=>g?.query?.filter(C=>C?.script?.length)?.map(C=>({calendarConfig:g,query:C}))).filter(Boolean).flat();const y=c.map(async g=>{const{calendarConfig:C,query:x}=g,{script:u="",scheduleStart:p="",scheduleEnd:f="",dateFormatter:D,isMilestone:N,queryType:O}=x;let L=[];O==="simple"?L=await logseq.DB.q(u)||[]:L=await logseq.DB.datascriptQuery(u),console.log("[faiz:] === search blocks by query: ",u,L);const q=re.exports.flattenDeep(L).map(E=>tn({block:E,queryWithCalendar:g,agendaCalendarIds:a,settings:r}));return Promise.all(q)}),k=await Promise.allSettled(y),w=[];if(k.forEach((g,C)=>{if(g.status==="fulfilled")w.push(g.value);else{console.error("[faiz:] === scheduleRes error: ",c[C],g);const{calendarConfig:x,query:u}=c[C],p=`Query Exec Error:
calendar: ${x.id}
query: ${u.script}
message: ${g.reason.message}`;logseq.App.showMsg(p,"error")}}),n=re.exports.flattenDeep(n.concat(w)),s?.enabled){const g=await logseq.DB.q(`[[${s.id}]]`);console.log("[faiz:] === search logs",g);const x=(g?.filter(p=>(p.headingLevel&&p.format==="markdown"&&(p.content=p.content.replace(new RegExp(`^#{${p.headingLevel}} `),"")),p.content?.trim()===`[[${s.id}]]`))?.map(p=>Array.isArray(p.parent)?p.parent:[])?.flat()?.filter(p=>(p.content?.trim()).length>0&&p?.page?.journalDay&&!p.marker&&!p.scheduled&&!p.deadline)||[])?.map(async p=>{const f=p?.page?.journalDay,{start:D,end:N}=Ct(p?.content.replace(new RegExp(`^${p.marker} `),"")),O=D||N;return await le({blockData:p,category:O?"time":"allday",start:D?ee(Y(f+" "+D,"yyyyMMdd HH:mm",new Date)):ve(f),end:N?ee(Y(f+" "+N,"yyyyMMdd HH:mm",new Date)):void 0,calendarConfig:s,defaultDuration:i,isAllDay:!O,isReadOnly:!0})}),u=await Promise.all(x);n=n.concat(u)}return n},tn=async({block:t,queryWithCalendar:a,agendaCalendarIds:n,settings:r})=>{const{calendarConfig:o,query:s}=a,{script:i="",scheduleStart:l="",scheduleEnd:m="",dateFormatter:c,isMilestone:y,queryType:k}=s,{defaultDuration:w}=r,g=["scheduled","deadline"].includes(l||m)?pt:c||ut,C=re.exports.get(t,l,void 0),x=re.exports.get(t,m,void 0);let u=/[Hhm]+/.test(g||""),p,f;try{p=C&&ve(C,g),f=x&&(u?ve(x,g):ee(jt(Y(x,g,new Date))))}catch(q){return console.warn("[faiz:] === parse calendar date error: ",q,t,s),[]}if(t?.page?.["journal-day"]){const{start:q,end:E}=Ct(t?.content.replace(new RegExp(`^${t.marker} `),""));if(q||E){const R=t?.page?.["journal-day"];p=q?ee(Y(R+" "+q,"yyyyMMdd HH:mm",new Date)):ve(R),f=E?ee(Y(R+" "+E,"yyyyMMdd HH:mm",new Date)):void 0,u=!0}}if(C&&["scheduled","deadline"].includes(l)){const q=t.content?.split(`
`)?.find(R=>R.startsWith(`${l.toUpperCase()}:`))?.trim(),E=/ (\d{2}:\d{2})[ >]/.exec(q)?.[1]||"";E&&(p=ee(Y(`${C} ${E}`,"yyyyMMdd HH:mm",new Date)),u=!0)}if(x&&["scheduled","deadline"].includes(m)){const q=t.content?.split(`
`)?.find(R=>R.startsWith(`${m.toUpperCase()}:`))?.trim(),E=/ (\d{2}:\d{2})[ >]/.exec(q)?.[1]||"";E&&(f=ee(Y(`${x} ${E}`,"yyyyMMdd HH:mm",new Date)),u=!0)}let D=u?"time":"allday";y&&(D="milestone");const N=D,O=an(t,f||p);!y&&O&&(D="task");const L=await le({blockData:{...t,category:N},category:D,start:p,end:f,calendarConfig:o,defaultDuration:w,isAllDay:!y&&!u&&!O,isReadOnly:!on(t,o.id,n)});return O?[L,{...L,id:`overdue-${L.id}`,start:d().startOf("day").toISOString(),end:d().endOf("day").toISOString(),isAllDay:!1}]:L},an=(t,a)=>t.marker&&t.marker!=="DONE"?Wt($t(new Date),ot(a)):!1,Ct=t=>{const a=t.match(pe);return a?{start:a[1],end:a[2]?.slice(1)}:{start:void 0,end:void 0}},At=(t,a,n)=>{const r=`${a}${n?"-"+n:""}`;return t.match(pe)?t.replace(pe,r):r+" "+t},Dt=t=>t.replace(pe,""),nn=async t=>{const a=/\(\([0-9a-z\-]{30,}\)\)/;if(a.test(t)){const n=a.exec(t)?.[0]?.replace("((","")?.replace("))","");if(n){const r=await se({uuid:n},!0);return t.replace(a,r?.content||"")}}return t};async function le(t){const{id:a,blockData:n,category:r="time",start:o,end:s,calendarConfig:i,isAllDay:l,defaultDuration:m,isReadOnly:c}=t;if(!n?.id){const p=await se({uuid:n.uuid?.$uuid$},!0);p&&(n.id=p.id)}let y=n?.page;re.exports.has(y,"id")&&re.exports.has(y,"name")&&re.exports.has(y,"original-name")&&(y={id:y.id,journalDay:y["journal-day"],journal:y["journal?"],name:y.name,originalName:y["original-name"]}),n.page=y,n.fullContent=await nn(n.content);const k=n.fullContent.split(`
`)[0]?.replace(new RegExp(`^${n.marker} `),"")?.replace(pe,"")?.trim?.(),w=n.marker==="DONE";function g(){return!!(n.page?.properties?.agenda===!0||n?.page?.["journal-day"]&&!n?.scheduled&&!n?.deadline)}const C=c===void 0?g():!c,{defaultDuration:x}=$;let u=s;if(r==="time"&&!s&&o&&m){const p=m.value||x.value,f=m.unit||x.unit;u=d(o).add(p,f).toISOString()}return n?.category!=="time"&&!s&&(u=o),{id:a||String(n.id),calendarId:i.id,title:w?`\u2705${k}`:k,body:n.fullContent,category:r,dueDateClass:"",start:o,end:u,raw:n,color:i?.textColor,bgColor:i?.bgColor,borderColor:i?.borderColor,isAllDay:l,customStyle:w?"opacity: 0.6;":"",isReadOnly:!C}}const ve=(t,a=pt)=>ee(Y(""+t,a,new Date)),rn=t=>{let a=new Map;return t.forEach(n=>{const r=n.calendarId||"";a.has(r)||a.set(r,[]),a.get(r)?.push(n)}),a},St=async()=>{const{calendarList:t}=logseq.settings,a=t.map(r=>te({originalName:r.id}));return(await Promise.all(a)).map((r,o)=>!r||r?.properties?.agenda!==!0?null:t[o]).filter(function(r){return Boolean(r)})},on=(t,a,n)=>!!(n.includes(a)||t?.page?.["journal-day"]&&!t?.scheduled&&!t?.deadline),We=t=>{const a=["DOING","NOW"],n=["TODO","LATER"],r=["DONE"];return{doing:t.filter(o=>a.includes(o?.raw?.marker)),todo:t.filter(o=>n.includes(o?.raw?.marker)),done:t.filter(o=>r.includes(o?.raw?.marker))}},sn=t=>{const a=new Map;return t.forEach(n=>{const r=d(n.start).startOf("day").toISOString();a.has(r)||a.set(r,[]),a.get(r)?.push(n)}),a},ye=Z([]),$e=Z([]),Ue=Z(t=>t(ye).concat(t($e))),ln=Z(t=>t(ye).filter(a=>!a.id?.startsWith("overdue-"))),cn=Z(t=>rn(t(ln))),dn=Z(t=>{const a=t(Ue);return console.log("[faiz:] === allSchedulesAtom",a),a.filter(n=>{const r=d(n.start),o=d(n.end||r);return d().isBetween(r,o,"day","[]")}).sort((n,r)=>d(n.start).diff(d(r.start)))}),Ye=Z(t=>{const a=t(dn),{logKey:n}=Q();return a.filter(r=>r.raw?.marker)?.filter(r=>n?.enabled===!1?!0:r.calendarId!==n?.id)?.filter(r=>r.raw?.category!=="milestone")}),un=Z(t=>{const n=t(Ue).filter(s=>s.raw?.marker),r=d().subtract(14,"day"),o=d();return n.filter(s=>d(s.start).isBetween(r,o,"day","(]"))}),Ge=Z(t=>{const{calendarList:a,subscriptionList:n,logKey:r}=Q();return(r?.enabled?[r]:[]).concat(a?.filter(i=>i?.enabled)).map(i=>i.id).map(i=>{const l=t(cn).get(i);if(!l)return null;const{doing:m,todo:c,done:y}=We(l),k=w=>{const{raw:g={},start:C,end:x,id:u="",title:p=""}=w,f=d(C),D=d(x);return{id:u,title:p,start:f.format("YYYY-MM-DD"),end:x?D.format("YYYY-MM-DD"):f.format("YYYY-MM-DD"),raw:{blockData:g,calendarSchedule:w},detailPopup:h("div",{className:"text-xs",children:[e("div",{className:"font-bold text-base my-2",children:p}),e("div",{className:"my-2",children:`${f.format("YYYY.MM.DD hh:mm a")} - ${D.format("hh:mm a")}`}),e("p",{className:"whitespace-pre-line",children:g.content}),e("a",{onClick:async()=>{const N=g,{id:O,originalName:L}=N?.page||{};let q=L;q||(q=(await te({id:O}))?.originalName);const{uuid:E}=await logseq.Editor.getBlock(N.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(q,E),logseq.hideMainUI()},children:"Navigate to block"})]})}};return{id:i,title:i,amount:{doing:m?.length,todo:c?.length,done:y?.length},style:{bgColor:l?.[0]?.bgColor||"#fff",borderColor:l?.[0]?.borderColor||"#fff",color:l?.[0]?.color||"#000"},events:l.filter(w=>w.category!=="milestone").map(k),milestones:l.filter(w=>w.category==="milestone").map(k)}}).filter(function(i){return Boolean(i)}).filter(i=>r?.enabled===!1?!0:i.id!==r?.id)}),Nt=36,ne=40,Ce=30,mn={day:108,week:44,month:20},pn=[{value:"simple",label:"Simple"},{value:"advanced",label:"Advanced"}],hn=[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}],ze=(t,a)=>{const n=[];let r=t;for(;r.isSameOrBefore(a);)n.push(r.clone()),r=r.add(1,"day");return n},Tt=t=>t.day()===0||t.day()===6,gn=(t,a="simple")=>{let n=[];return t.forEach((r,o)=>{const s=n[o-1],{levelCount:i=0,events:l=[],milestones:m=[]}=s||{},c=a==="simple"?i:l.length,y=a==="simple"?m.length>0?1:0:m.length,k=o===0?0:s.coordinate.y+(c+y)*ne+Nt+Ce;n.push({...r,coordinate:{x:0,y:k}})}),n},qt=(t,a,n)=>a.diff(t,"day")*n,Ae=(t,a="")=>{document.querySelector(`#date${a}${t.format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"})},fn=t=>t.map(a=>Mt(a)),yn=t=>t.map(a=>wn(a)),wn=t=>{const{events:a,rangeStart:n,rangeEnd:r}=Mt(t);let o=It(a,[],d(n),d(r));return{...t,levelCount:o.length,events:o.map((s,i)=>s.map(l=>({...l,level:i}))).flat()}},Mt=t=>{const{events:a,milestones:n}=t;a.sort((m,c)=>d(m.start).diff(d(c.start)));let r=new Map;a.forEach(m=>{const{start:c}=m;r.has(c)?r.get(c)?.push(m):r.set(c,[m])}),r.forEach(m=>{m.sort((c,y)=>{const k=d(c.end).diff(d(c.start),"day");return d(y.end).diff(d(y.start),"day")-k})});const o=Array.from(r.values()),s=o[0]?.[0]?.start,i=o[o.length-1]?.[0]?.end,l=o.flat();return{...t,events:l,milestones:n?.sort((m,c)=>d(m.start).diff(d(c.start))),rangeStart:s,rangeEnd:i}};function kn(t,a){const n=new Map;return ze(t,a).forEach(r=>{n.set(r.format("YYYY-MM-DD"),!1)}),n}function It(t=[],a=[],n,r){const o=kn(d(n),d(r)),s=[],i=[];return t.forEach(l=>{const{start:m,end:c}=l,y=d(m),k=d(c),w=ze(y,k).map(g=>g.format("YYYY-MM-DD"));o.get(y.format("YYYY-MM-DD"))===!1?(w.forEach(g=>{o.set(g,!0)}),s.push(l)):i.push(l)}),a.push(s),i?.length===0?a:It(i,a,n,r)}const bn=t=>{const a=t.map(o=>{const{events:s,milestones:i=[]}=o;return[...s,...i]}).flat();let n=d(),r=d();return a.forEach(o=>{const{start:s,end:i}=o;d(s).isBefore(n)&&(n=d(s)),d(i).isAfter(r)&&(r=d(i))}),{start:n,end:r}},xn=({data:t,mode:a="simple",view:n="day",weekStartDay:r=0,uniqueId:o=""},s)=>{const i=d(),{start:l,end:m}=bn(t),c=l.subtract(1,"day"),y=m.add(9,"day"),k=mn[n],w=ze(c,y),C=gn(t,a).map((u,p)=>{const{events:f,milestones:D=[]}=u,N=a==="simple"?(u.levelCount||0)*ne:f.length*ne,O=a==="simple"?(D.length>0?1:0)*ne:D.length*ne,L=N+O+Ce;return{...u,height:L,events:u.events.map((q,E)=>{const R=a==="simple"?q?.level||0:E;return{...q,coordinates:{x:qt(c,d(q.start),k),y:u.coordinate.y+R*ne},size:{width:k*(d(q.end).diff(d(q.start),"day")+1)-8,height:ne-4}}}),milestones:u.milestones?.map((q,E)=>{const R=a==="simple"?0:E;return{...q,coordinates:{x:qt(c,d(q.start),k),y:u.coordinate.y+N+R*ne}}})}}),x=C.reduce((u,p)=>u+p.height+Nt,0);return console.log("[faiz:] === dataWithCoordinates",C),A.exports.useEffect(()=>{document.querySelector(`#date${o}${d().format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center"})},[]),A.exports.useImperativeHandle(s,()=>({scrollToToday(){Ae(d(),o)}})),h("div",{className:"calendar h-fit w-fit",children:[e("div",{className:"w-fit whitespace-nowrap bg-quaternary sticky top-0 z-20 text",children:w.map(u=>{const f=u.format("DD")==="01"||u.isSame(c,"day")||u.isSame(y,"day");return e("div",{className:"inline",children:e("span",{className:"inline-block text-center sticky bg-quaternary overflow-visible box-content",style:{width:`${k}px`,left:0,lineHeight:"25px",paddingRight:"100px",marginRight:"-100px"},children:f?u.format("MMMM YYYY"):""})},"month"+u.valueOf())})}),e("div",{className:"calendar__header w-fit whitespace-nowrap bg-quaternary sticky z-20",style:{top:"25px"},children:w.map(u=>{const p=u.format("DD"),f=Tt(u),D=u.isSame(i,"day");let N=!0;return n==="month"&&(N=u.day()===r||D),e("div",{className:`calendar__date inline-flex ${f?"weekend":""} ${D?"today":""}`,id:"date"+o+u.format("YYYYMMDD"),children:e("span",{className:`inline-block text-center ${N?"":"opacity-0"}`,style:{width:"108px"},children:p})},"date"+u.valueOf())})}),e("div",{className:"calendar__content relative",style:{height:x+"px"},children:C.map(u=>h("div",{className:"calendar__group w-fit",children:[e("div",{className:"flex",children:w.map((p,f)=>{const D=Tt(p),N=p.isSame(i,"day");return e("div",{className:`calendar__content__back ${D?"weekend":""} ${N?"today":""}`,style:{height:u.height+"px"}})})}),u.events.map(p=>{const{coordinates:f,size:D,detailPopup:N}=p;return e("div",{className:"calendar__event absolute bg-quaternary rounded cursor-pointer single_ellipsis shadow",style:{left:f.x,top:f.y+Ce,width:D.width+"px",height:D.height+"px",zIndex:1},title:p.title,children:e(st,{content:N,trigger:"click",children:p.title})},p.id)}),u.milestones?.map(p=>{const{coordinates:f,detailPopup:D}=p;return h(ue,{children:[e("div",{className:"calendar__milestone__line absolute",style:{left:f.x+k/2,top:u.coordinate.y,height:u.height+16}},"milestone-line"+p.id),e("div",{className:"calendar__milestone__text absolute flex items-center cursor-pointer",style:{left:f.x+2+k/2,top:f.y+Ce},title:p.title,children:e("span",{className:"single_ellipsis",style:{maxWidth:k-20},children:e(st,{content:D,trigger:"click",children:p.title})})},"milestone-text"+p.id)]})})]},u.id))})]})};var vn=A.exports.forwardRef(xn);const Cn=({groupName:t,events:a,milestones:n=[],mode:r,levelCount:o=0,uniqueId:s=""})=>h("div",{className:"group rounded-sm",children:[e("div",{className:"group__title font-medium sticky bg-quaternary title-text",children:t}),h("div",{className:"group__content",children:[r==="simple"?new Array(o).fill(0).map((i,l)=>e("div",{className:"group__event cursor-pointer"})):a.map(i=>e("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>Ae(d(i.start),s),children:i?.title})),r==="simple"?n?.length>0?e("div",{className:"group__event cursor-pointer flex justify-between items-center"}):null:n?.map((i,l)=>e("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>Ae(d(i.start),s),children:i?.title}))]})]});const Qe=({weekStartDay:t,data:a,showSidebar:n=!0,showOptions:r=!0,defaultView:o="day",defaultMode:s="simple",showModeSelector:i=!1,theme:l="light",uniqueId:m="",...c})=>{const y=A.exports.useRef(),[k,w]=A.exports.useState(o),[g,C]=A.exports.useState(s),x=g==="simple"?yn(a):fn(a);return h("div",{className:M(`w-full h-full relative gantt text view-${k}`,{dark:l==="dark"},{light:l!=="dark"}),...c,children:[n&&e("div",{className:"calendar__placeholder absolute bg-quaternary"}),r&&h("div",{className:"operation absolute right-0 top-0 z-30 bg-quaternary",children:[e(G,{size:"small",shape:"round",onClick:()=>Ae(d(),m),children:"Today"}),e(F,{size:"small",options:hn,defaultValue:k,onChange:u=>w(u),style:{minWidth:"80px"},className:"ml-2 select-style"}),i&&e(F,{size:"small",options:pn,defaultValue:"simple",onChange:u=>C(u),style:{minWidth:"110px"},className:"ml-2 select-style"})]}),h("div",{className:"flex h-full overflow-auto relative scroll-style",children:[n&&e("div",{className:"side-bar bg-quaternary sticky left-0 z-10 h-fit",children:x.map((u,p)=>e(Cn,{mode:g,groupName:u.title,events:u?.events,milestones:u?.milestones,levelCount:u.levelCount,uniqueId:m},u.id))}),e(vn,{data:x,ref:y,mode:g,view:k,uniqueId:m})]})]})},An="_content_xe2qi_1",Dn="_stats_xe2qi_4",Sn="_statsRight_xe2qi_7",Nn="_amount_xe2qi_10",Tn="_project_xe2qi_15",qn="_projectContent_xe2qi_18",Mn="_milestone_xe2qi_22",In="_timeline_xe2qi_26",En="_showTimeline_xe2qi_26",_n="_option_xe2qi_39",Bn="_rightSide_xe2qi_43",On="_taskLine_xe2qi_49",Ln="_module_xe2qi_52",Pn="_task_xe2qi_49",Rn="_taskDone_xe2qi_66",Hn="_taskActive_xe2qi_69",Fn="_time_xe2qi_26",jn="_overdue_xe2qi_93",Wn="_subscription_xe2qi_96";var B={content:An,stats:Dn,statsRight:Sn,amount:Nn,project:Tn,projectContent:qn,milestone:Mn,timeline:In,showTimeline:En,option:_n,rightSide:Bn,taskLine:On,module:Ln,task:Pn,taskDone:Rn,taskActive:Hn,time:Fn,overdue:jn,subscription:Wn};function $n(t){const{milestones:a=[]}=t;if(a?.length===0)return null;const n=a.filter(r=>d(r.start).isSameOrAfter(d(),"day"));return n.length===0?null:n.sort((r,o)=>d(r.start).diff(d(o.start)))?.[0]}const Un=({data:t})=>{const[a,n]=A.exports.useState(!1),r=fe(),o=$n(t),s=t?.amount?.doing||0,i=t?.amount?.todo||0,l=t?.amount?.done||0,m=s+i+l,c=m===0?0:l/m,y=async w=>{console.log("[faiz:] === milestone",w);const{raw:g={},start:C,end:x,id:u="",title:p=""}=w,f=g?.blockData,{id:D,originalName:N}=f?.page||{};let O=N;O||(O=(await te({id:D}))?.originalName);const{uuid:L}=await logseq.Editor.getBlock(f.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(O,L),logseq.hideMainUI()},k=async()=>{const w=t.id,g=await te({originalName:w});g?.properties?.agenda?(logseq.App.pushState("page",{name:g.originalName}),logseq.hideMainUI()):logseq.App.showMsg("This is not an agenda project.","warning")};return h("div",{className:M(B.project),children:[h("div",{className:M("flex flex-col flex-1 w-0",B.projectContent,{[B.expand]:a}),children:[h("div",{className:"flex justify-between items-center h-24 p-3",children:[h("div",{className:"h-full flex items-center cursor-pointer",onClick:k,children:[e("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-lg font-medium",style:{backgroundColor:t?.style?.bgColor,color:t?.style?.color},children:t.title?.[0]?.toUpperCase()}),h("div",{className:"ml-3",children:[e("div",{className:"text-lg title-text",children:t.title}),e("div",{className:"mt-1 description-text",children:`doing: ${t?.amount?.doing||0} todo: ${t?.amount?.todo||0} done: ${t?.amount?.done||0}`})]})]}),h("div",{className:"h-full flex items-center",children:[e("div",{style:{width:"4.375rem"},children:e(vt,{progress:parseInt(""+c*100),uniqueId:t.id,height:70,type:"normal"})}),o&&h("div",{className:M("flex flex-col items-center justify-center d h-full pl-3 pr-1 ml-3 cursor-pointer",B.milestone),onClick:()=>y(o),children:[h("div",{className:"text-center",children:[e("span",{className:"text-3xl title-text",children:d(o.start).format("DD")}),e("span",{className:"text-xs description-text ml-1",children:d(o.start).format("MMM")})]}),h("span",{className:"text-xs description-text",children:["days left: ",d(o.start).diff(d(),"day"),"d"]}),e("span",{className:"text-xs description-text ellipsis w-full",title:o.title,children:o.title})]})]})]}),e(Ne,{children:a&&e(Te.div,{className:M(B.timeline,{[B.showTimeline]:a}),initial:{opacity:0,height:0},animate:{opacity:1,height:"auto",marginTop:"0.5rem",padding:"0.75rem"},exit:{opacity:0,height:0,marginTop:0,padding:0},transition:{ease:"easeInOut",duration:.2},children:e(Qe,{data:[t],weekStartDay:0,showOptions:!1,showSidebar:!1,defaultView:"week",theme:r,uniqueId:t?.id})})})]}),e("div",{className:M(B.option,"text w-10 h-10 rounded-full flex justify-center items-center shadow-sm text-lg ml-3 cursor-pointer"),onClick:()=>n(!a),children:e("div",{className:"flex items-center",children:a?e(qe,{}):e(Me,{})})})]})};function Yn(t){const a=d(t.start),n=d(t.end),r=a.isSame(n,"day");return t.isAllDay?r?"All Day":`${a.format("MMM DD")} - ${n.format("MMM DD")}`:r?`${a.format("HH:mm")} - ${n.format("HH:mm")}`:`${a.format("MMM DD HH:mm")} - ${n.format("MMM DD HH:mm")}`}const Ve=({task:t,showTimeDot:a=!1,type:n="allDay"})=>{const r=d(t.start),o=d(t.end);r.isSame(o,"day");const s=n!=="overdue"&&d().isBetween(r,o),i=t?.raw?.marker==="DONE";return h("div",{className:M(B.task,{[B.taskActive]:s,[B.taskDone]:i},B?.[n],"flex pl-5 pr-4 py-2 items-center justify-between"),children:[a&&e("div",{className:M(B.time),children:e("span",{children:r?.format("HH:mm")})}),e("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:t.bgColor,color:t.color},title:t.calendarId,children:t?.calendarId?.[0]?.toUpperCase()}),h("div",{className:"flex flex-col flex-1 ellipsis mx-4",children:[e("span",{className:"ellipsis text",children:t.title}),h("div",{className:M(B.subscription,"text-xs flex justify-between"),children:[e("span",{className:"description-text",children:Yn(t)}),e("span",{className:"ml-2 ellipsis #6b531a",title:t.calendarId,children:t.calendarId})]})]}),e("div",{className:"w-5 h-5 cursor-pointer text",onClick:async()=>{const l=t.raw,{id:m,originalName:c}=l?.page||{};let y=c;y||(y=(await te({id:m}))?.originalName);const{uuid:k}=await logseq.Editor.getBlock(l.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(y,k),logseq.hideMainUI()},children:e(Ut,{})})]})};function Gn(t){let a=[],n=[],r=[];return t.forEach(o=>{o.category==="task"?a.push(o):o.isAllDay?n.push(o):r.push(o)}),{overdueTasks:a,allDayTasks:n,timeTasks:r}}const zn=()=>{const[t]=j(Ye);console.log("[faiz:] === todayTasks",t);const{overdueTasks:a,allDayTasks:n,timeTasks:r}=Gn(t);return h("div",{className:B.taskLine,children:[a.length>0&&h("div",{className:B.module,children:[e("span",{children:"Overdue"}),a.map(o=>e(Ve,{task:o,type:"overdue"},o.id))]}),n.length>0&&h("div",{className:B.module,children:[e("span",{children:"All Day"}),n.map(o=>e(Ve,{task:o,type:"allDay"},o.id))]}),r.length>0&&h("div",{className:B.module,children:[e("span",{children:"Time"}),r.map(o=>e(Ve,{task:o,type:"time",showTimeDot:!0},o.id))]})]})};function Qn(){const[t]=j(un),a=sn(We(t)?.done),n=d().subtract(13,"day").startOf("day"),r=[n];for(let o=1;o<14;o++)r.push(n.add(o,"day"));return r.map(o=>{const s=a.get(o.toISOString());return{date:o.toISOString(),value:s?.length||0}})}const Vn=()=>{const t=Qn(),[a]=j(Ge),n=a||[],[r]=j(Ye),o=We(r),s=o?.todo?.length+o?.doing?.length,i=o?.done?.length,l=s+i,m=l===0?0:parseInt(i/l*100+""),c=async()=>{const{preferredDateFormat:y}=await logseq.App.getUserConfigs(),k=K(Y(d().format("YYYY-MM-DD"),oe,new Date),y);logseq.App.pushState("page",{name:k}),logseq.hideMainUI()};return h("div",{className:"page-container flex",children:[h("div",{className:M(B.content,"flex flex-col flex-1 p-8"),children:[e("h1",{className:"title-text",children:"Dashboard"}),h("div",{className:"flex-1 overflow-auto",children:[h("div",{className:M(B.stats,"flex"),children:[e("div",{className:"flex-1",children:e(en,{data:t})}),h("div",{style:{width:"160px"},className:M("h-full rounded-xl shadow-sm cursor-pointer",B.statsRight),onClick:c,children:[e(vt,{progress:m}),h("div",{className:"flex justify-between px-6",children:[h("div",{className:M("flex flex-col rounded-lg text-center py-1 shadow-sm",B.amount),children:[e("span",{className:"text-3xl title-text",children:s}),e("span",{className:"text",children:"Todo"})]}),h("div",{className:M("flex flex-col rounded-lg text-center py-1 shadow-sm",B.amount),children:[e("span",{className:"text-3xl title-text",children:i}),e("span",{className:"text",children:"Done"})]})]})]})]}),e("div",{className:"mt-8",children:n.map(y=>e(Un,{data:y},y.id))})]})]}),e("div",{className:B.rightSide,children:e(zn,{})})]})},Et=({visible:t,initialValues:a,onCancel:n,onSave:r,type:o="create",calendar:s,showKeepRef:i})=>{const[l,m]=A.exports.useState([]),[c,y]=A.exports.useState(!a?.isAllDay),[k]=b.useForm(),w=(x,u)=>{if(x.isAllDay!==void 0&&y(!x.isAllDay),x.start!==void 0&&k.setFieldsValue({end:x.start.add(1,"hour")}),x.calendarId?.value==="journal"){const p=u.start,f=u.end;p.isSame(f,"day")||k.setFieldsValue({end:p.add(1,"hour")})}},g=()=>{k.validateFields().then(async x=>{const{calendarId:u,title:p,start:f,end:D,isAllDay:N}=x,O=d(f).format("YYYY-MM-DD"),L=d(D).format("YYYY-MM-DD"),q=d(f).format("HH:mm"),E=d(D).format("HH:mm"),R=l.find(T=>T.id===u?.value);console.log("[faiz:] === onClickSave",x);const X=u?.value==="journal";if(d(f).isAfter(d(D)))return logseq.App.showMsg("Start time cannot be later than end time","error");if(X&&!d(f).isSame(d(D),"day"))return logseq.App.showMsg("Journal schedule cannot span multiple days","error");let V=`TODO ${p}`;if(X&&(o==="create"&&(V=N?`TODO ${p}`:`TODO ${q}-${E} ${p}`),o==="update")){const T=a?.raw?.marker,P=p.replace(new RegExp(`^${T} `),"");V=N?`${T} `+Dt(P):`${T} `+At(P,q,E)}if(!X&&o==="update"){const T=a?.raw?.marker||"TODO",P=p.replace(new RegExp(`^${T} `),"");V=`${T} `+Dt(P)}const S=X?{}:{start:N?O:`${O} ${q}`,end:N?L:`${L} ${E}`},{preferredDateFormat:_}=await logseq.App.getUserConfigs();let v=a?.calendarId;if(a?.calendarId==="journal"){const T=a?.start;T&&(v=K(T?.valueOf(),_))}let I=u?.value;if(u?.value==="journal"){console.log("[faiz:] === values",x);const T=K(f.valueOf(),_),P=await logseq.Editor.createPage(T,{},{journal:!0});P&&(I=P.originalName),console.log("[faiz:] === journalName",T,P)}if(o==="create"){const T=logseq.settings?.logKey;let P;if(X?P=T?.enabled?await ft(I,`[[${T?.id}]]`,V,S):await logseq.Editor.insertBlock(I,V,{isPageBlock:!0,sibling:!0,properties:S}):P=await ft(I,ht,V,S),!P)return logseq.App.showMsg("Create block failed","error");const W=await logseq.Editor.getBlock(P.uuid);s?.createSchedules([await le({blockData:W,category:N?"allday":"time",start:d(f).format(),end:d(D).format(),calendarConfig:R,isAllDay:N,isReadOnly:!1})])}else if(I!==v&&a?.id){let T;const P=logseq.settings?.logKey;if(i&&x?.keepRef){const W=await logseq.Editor.getBlock(Number(a?.id));W&&await logseq.Editor.insertBlock(W.uuid,`((${W.uuid}))${X?"":` #${I}`}`,{before:!1,sibling:!0})}if(X?T=P?.enabled?await He(Number(a.id),I,`[[${P?.id}]]`):await gt(Number(a.id),I):T=await He(Number(a.id),I,ht),await he(T.uuid,V,S),Object.keys(S).length===0&&(await logseq.Editor.removeBlockProperty(T.uuid,"start"),await logseq.Editor.removeBlockProperty(T.uuid,"end")),T&&a.calendarId){const W=await logseq.Editor.getBlock(T.uuid);s?.deleteSchedule(String(a.id),a.calendarId),s?.createSchedules([await le({blockData:W,category:N?"allday":"time",start:d(f).format(),end:d(D).format(),calendarConfig:R,isAllDay:N,isReadOnly:!1})])}}else if(a?.id){u.value==="journal"?await he(Number(a.id),V):await he(Number(a.id),p,S);const T=await logseq.Editor.getBlock(Number(a.id));console.log("[faiz:] === blockAfterUpdated",T),s?.updateSchedule(a.id,u?.value,await le({blockData:T,category:N?"allday":"time",start:d(f).format(),end:d(D).format(),calendarConfig:R,isAllDay:N,isReadOnly:!1}))}r?.()})},C=()=>{n?.()};return A.exports.useEffect(()=>{const{calendarList:x}=logseq.settings;St().then(u=>{m([x[0]].concat(u))})},[]),e(ie,{title:"Modify Schedule",visible:t,onOk:g,onCancel:C,children:h(b,{form:k,onValuesChange:w,initialValues:{...a,calendarId:a?.calendarId?{value:a?.calendarId}:void 0},children:[e(b.Item,{name:"calendarId",label:"Calendar",rules:[{required:!0}],children:e(F,{labelInValue:!0,children:l.map(x=>h(F.Option,{value:x.id,children:[e("span",{style:{width:"12px",height:"12px",display:"inline-block",backgroundColor:x.bgColor,verticalAlign:"middle",marginRight:"5px",borderRadius:"4px"}}),x.id]},x.id))})}),e(b.Item,{name:"title",label:"Schedule Title",rules:[{required:!0}],children:e(z,{})}),e(b.Item,{name:"start",label:"Start",rules:[{required:!0}],children:e(lt,{showTime:c?{format:"HH:mm"}:!1})}),e(b.Item,{name:"end",label:"End",rules:[{required:!0}],children:e(lt,{showTime:c?{format:"HH:mm"}:!1})}),e(b.Item,{name:"isAllDay",label:"All Day",rules:[{required:!0}],children:h(H.Group,{children:[e(H,{value:!0,children:"Yes"}),e(H,{value:!1,children:"No"})]})}),i&&e(b.Item,{name:"keepRef",label:"Keep Ref",rules:[{required:!0}],children:h(H.Group,{children:[e(H,{value:!0,children:"Yes"}),e(H,{value:!1,children:"No"})]})})]})})},_t=({checked:t,color:a,onChange:n,children:r,...o})=>h("div",{onClick:()=>n?.(!t),...o,children:[e("span",{className:`check-box mr-2 ${t?"checked":""}`,style:{backgroundColor:a}}),r]}),Kn=({onShowCalendarChange:t,calendarList:a=[],subscriptionList:n=[]})=>{const[r,o]=A.exports.useState(["calendar","subscription"]),[s,i]=A.exports.useState(a.map(c=>c.id)?.concat(n?.map(c=>c.id))),l=(c,y)=>{let k=s.filter(w=>w!==c);y&&(k=s.concat(c)),i(k),t?.(k)},m=c=>e("span",{className:"text text-xs",children:c});return e("div",{className:"sidebar pt-2 bg-quaternary",children:h(Ie,{ghost:!0,expandIconPosition:"right",activeKey:r,expandIcon:({isActive:c})=>e("span",{className:"opacity-50",children:e(Yt,{rotate:c?0:-90})}),onChange:c=>o(typeof c=="string"?[c]:c),children:[e(Ie.Panel,{header:m("Calendar"),children:a.map(c=>e(_t,{className:"mb-1 cursor-pointer flex items-center",color:c.bgColor,checked:s?.includes(c.id),onChange:y=>l(c.id,y),children:e(me,{title:c.id,placement:"right",children:e("span",{className:"singlge-line-ellipsis flex-1",children:c.id})})},c.id))},"calendar"),n?.length>0&&e(Ie.Panel,{header:m("Subscription"),className:"mt-3",children:n.map(c=>e(_t,{className:"mb-1 cursor-pointer flex items-center",color:c.bgColor,checked:s?.includes(c.id),onChange:y=>l(c.id,y),children:e(me,{title:c.id,placement:"right",children:e("span",{className:"singlge-line-ellipsis flex-1",children:c.id})})},c.id))},"subscription")]})})},Zn=({visible:t,onCancel:a,start:n,end:r,...o})=>{const[s,i]=A.exports.useState();return A.exports.useEffect(()=>{n&&r&&Ka(n,r).then(l=>{i(l?.map(m=>m.content)?.join(`

`))})},[n,r]),e(ie,{...o,destroyOnClose:!0,title:"Weekly Logs",okText:"Copy And Close",visible:t,onCancel:a,onOk:()=>{Za(s||""),a()},children:e(z.TextArea,{value:s,onChange:l=>i(l.target.value),rows:10})})},Xn="_container_q63c5_1",Jn="_content_q63c5_5",er="_calendarWrapper_q63c5_5",tr="_sideBar_q63c5_8";var Bt={container:Xn,content:Jn,calendarWrapper:er,sideBar:tr};const ar=()=>{const[t]=j(Ue),{calendarList:a,subscriptionList:n,logKey:r}=Q(),[o,s]=A.exports.useState(),[i,l]=A.exports.useState(!0),[m,c]=A.exports.useState(logseq.settings?.defaultView||"month"),y=(r?.enabled?[r]:[]).concat(a?.filter(S=>S?.enabled)),k=n?n?.filter(S=>S?.enabled):[],[w,g]=A.exports.useState({visible:!1,type:"create"}),[C,x]=A.exports.useState(Boolean(logseq.settings?.logKey?.enabled)&&logseq.settings?.defaultView==="week"),[u,p]=A.exports.useState({visible:!1}),f=A.exports.useRef(),D=()=>{if(f.current){const S=f.current.getDateRangeStart().getTime(),_=f.current.getDateRangeEnd().getTime();Zt(S,_)?s(K(S,oe)):s(K(S,oe)+" ~ "+K(_,oe))}},N=S=>{c(S),S!=="gantt"&&(S==="2week"?(f.current?.changeView("month"),f.current?.setOptions({month:{visibleWeeksCount:2}})):S==="month"?(f.current?.changeView("month"),f.current?.setOptions({month:{visibleWeeksCount:void 0}})):f.current?.changeView(S),D(),x(logseq.settings?.logKey?.enabled&&S==="week"))},O=S=>{(y.concat(k)?.map(v=>v.id)).forEach(v=>{S.includes(v)?f.current?.toggleSchedules(v,!1):f.current?.toggleSchedules(v,!0)})},L=()=>l(S=>!S),q=()=>{f.current?.today(),D()},E=()=>{f.current?.prev(),D()},R=()=>{f.current?.next(),D()},X=async()=>{if(m==="day"&&o){const{preferredDateFormat:S}=await logseq.App.getUserConfigs(),_=K(Y(o,oe,new Date),S);logseq.App.pushState("page",{name:_}),logseq.hideMainUI()}},V=async()=>{const[S,_]=o?.split(" ~ ")||[];p({visible:!0,start:S,end:_})};return A.exports.useEffect(()=>{f.current&&(console.log("[faiz:] === schedules changed and refresh calendar",t),f.current.clear(),f.current.createSchedules(t))},[t,f.current]),A.exports.useEffect(()=>{window.requestAnimationFrame(async()=>{const S=await La();console.log("[faiz:] === calendarOptions",S),f.current=new Gt("#calendar",{...S}),D(),f.current.on("clickDayname",function(_){const v=f.current;v?.getViewName()==="week"&&(v.setDate(new Date(_.date)),v.changeView("day",!0),D(),c("day"))}),f.current.on("clickSchedule",function(_){document.querySelector("#faiz-nav-detail")?.addEventListener("click",async v=>{const I=_.schedule.raw||{},{id:T,originalName:P}=I?.page||{};let W=P;W||(W=(await logseq.Editor.getPage(T))?.originalName);const{uuid:de}=await logseq.Editor.getBlock(I.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(W,de),logseq.hideMainUI()},{once:!0})}),f.current.on("beforeCreateSchedule",function(_){g({visible:!0,type:"create",values:{start:d(_.start),end:d(_.end),isAllDay:_.triggerEventName==="dblclick"}})}),f.current.on("beforeUpdateSchedule",async function(_){console.log("[faiz:] === beforeUpdateSchedule",_);const{schedule:v,changes:I,triggerEventName:T,start:P,end:W}=_;if(T==="click")g({visible:!0,type:"update",values:{id:v.id,start:d(v.start),end:d(v.end),isAllDay:v?.raw?.category!=="time",calendarId:v.calendarId,title:v.raw?.content?.split(`
`)[0],raw:v.raw}});else if(I){if(v.calendarId==="journal"&&!d(P).isSame(d(W),"day"))return logseq.App.showMsg("Journal schedule cannot span multiple days","error");let de={},et={};if(Object.keys(I).forEach(J=>{v.isAllDay?de[J]=d(I[J]).format("YYYY-MM-DD"):de[J]=d(I[J]).format("YYYY-MM-DD HH:mm"),et[J]=d(I[J]).format()}),f.current?.updateSchedule(v.id,v.calendarId,I),v.calendarId==="journal"){const J=v?.raw?.marker,Rt=v?.isAllDay?!1:`${J} `+At(v?.raw?.content?.replace(new RegExp(`^${J} `),""),d(v?.start).format("HH:mm"),d(v?.end).format("HH:mm"));let De=v?.raw?.page?.journalDay;if(De||(De=(await te(v?.raw?.page?.id))?.journalDay),I.start&&!d(I.start).isSame(d(String(De),"YYYYMMDD"),"day")){console.log("[faiz:] === move journal schedule");const{preferredDateFormat:tt}=await logseq.App.getUserConfigs(),at=K(d(I.start).valueOf(),tt),nt=logseq.settings?.logKey,Se=nt?.enabled?await He(v.raw?.id,at,`[[${nt?.id}]]`):await gt(v.raw?.id,at);console.log("[faiz:] === newBlock",Se,v,v?.id),Se&&(f.current?.deleteSchedule(String(v.id),v.calendarId),f.current?.createSchedules([await le({...v,blockData:Se,calendarConfig:a?.find(Ht=>Ht.id==="journal")})]))}else await he(v.raw?.id,Rt)}else await he(Number(v.id),!1,de)}}),f.current.on("beforeDeleteSchedule",function(_){const{schedule:v}=_;ie.confirm({title:"Are you sure delete this schedule?",content:e("div",{className:"whitespace-pre-line",children:v.raw?.content}),onOk:async()=>{const I=await logseq.Editor.getBlock(v.raw?.id);if(!I)return logseq.App.showMsg("Block not found","error");logseq.Editor.removeBlock(I?.uuid),f.current?.deleteSchedule(v.id,v.calendarId)}})})})},[]),e("div",{className:M("page-container","flex"),children:h("div",{className:M(Bt.content,"flex flex-1 flex-col overflow-hidden p-8"),style:{maxWidth:"1400px"},children:[e("h1",{className:"title-text",children:"Calendar"}),e("div",{className:M(Bt.calendarWrapper,"flex flex-col flex-1 rounded-2xl box-border"),children:h("div",{className:"flex flex-col w-full h-full p-6",children:[h("div",{className:"mb-2 flex items-center justify-between",children:[h("div",{className:"flex items-center",children:[e(G,{className:"mr-2",onClick:L,icon:i?e(zt,{}):e(Qt,{})}),e(F,{value:m,defaultValue:logseq.settings?.defaultView||"month",onChange:N,style:{width:"100px"},children:mt.map(S=>e(F.Option,{value:S.value,children:S.label},S.value))}),["day","week","2week","month"].includes(m)?h("div",{className:"flex items-center ml-4",children:[e(G,{shape:"round",onClick:q,children:"Today"}),e(G,{className:"ml-4",shape:"circle",icon:e(Vt,{}),onClick:E}),e(G,{className:"ml-1",shape:"circle",icon:e(Kt,{}),onClick:R}),e(me,{title:m==="day"?"Navigate to this journal note":"",children:e("span",{className:`ml-4 text-xl h-full items-center inline-block title-text ${m==="day"?"cursor-pointer":"cursor-auto"}`,style:{height:"34px",lineHeight:"34px"},onClick:X,children:o})})]}):null]}),e("div",{children:C&&e(G,{className:"mr-4",onClick:V,children:"Export Weekly"})})]}),h("div",{className:"flex flex-1",children:[e("div",{className:`transition-all overflow-hidden bg-quaternary title-text mr-2 ${i?"w-0 mr-0":"w-40"}`,children:e(Kn,{onShowCalendarChange:O,calendarList:y,subscriptionList:k})}),e("div",{className:"flex-1 w-0",children:e("div",{id:"calendar",className:"h-full title-text"})})]}),e(Zn,{visible:u.visible,start:u.start,end:u.end,onCancel:()=>p({visible:!1})}),w.visible?e(Et,{visible:w.visible,type:w.type,initialValues:w.values,calendar:f.current,onCancel:()=>{g({visible:!1}),f.current?.render()},onSave:()=>{g({visible:!1})}}):null]})})]})})},nr="_contentWrapper_42y1q_1",rr="_timelineWrapper_42y1q_7";var Ke={contentWrapper:nr,timelineWrapper:rr};const or=({project:t})=>{const[a,n]=A.exports.useState(!0),r=fe();return h("div",{className:M(Ke.timelineWrapper,{[Ke.expand]:a},"rounded-2xl mb-9 h-auto p-6 shadow"),children:[h("h3",{className:"title-text flex items-center cursor-pointer",onClick:()=>n(o=>!o),children:[t.title,a?e(qe,{className:"ml-2"}):e(Me,{className:"ml-2"})]}),e(Ne,{children:a&&e(Te.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"60vh"},exit:{opacity:0,height:0},transition:{ease:"easeInOut",duration:.2},children:e(Qe,{data:[t],weekStartDay:logseq.settings?.weekStartDay||0,theme:r,defaultMode:"advanced",uniqueId:t.id})})})]})},sr=()=>{const[t]=j(Ge),a=t||[];return h("div",{className:"page-container p-8 flex flex-col",children:[e("h1",{className:"title-text",children:"Gantt"}),e("div",{className:M(Ke.contentWrapper),children:a.map(n=>e(or,{project:n}))})]})},lr="_contentWrapper_42y1q_1",ir="_timelineWrapper_42y1q_7";var Ze={contentWrapper:lr,timelineWrapper:ir};const cr=({project:t})=>{const[a,n]=A.exports.useState(!0),r=fe();return h("div",{className:M(Ze.timelineWrapper,{[Ze.expand]:a},"rounded-2xl mb-9 h-auto p-6 shadow"),children:[h("h3",{className:"title-text flex items-center cursor-pointer",onClick:()=>n(o=>!o),children:[t.title,a?e(qe,{className:"ml-2"}):e(Me,{className:"ml-2"})]}),e(Ne,{children:a&&e(Te.div,{className:"overflow-hidden",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{ease:"easeInOut",duration:.2},children:e(Qe,{data:[t],weekStartDay:logseq.settings?.weekStartDay||0,showSidebar:!1,theme:r,uniqueId:t.id})})})]})},dr=()=>{const[t]=j(Ge),a=t||[];return h("div",{className:"page-container p-8 flex flex-col",children:[e("h1",{className:"title-text",children:"Timeline"}),e("div",{className:M(Ze.contentWrapper),children:a.map(n=>e(cr,{project:n}))})]})},ae=({value:t,onChange:a,text:n})=>{const[r,o]=A.exports.useState(!1);return h("div",{children:[e("span",{style:{backgroundColor:t},className:"px-2 py-1 rounded cursor-pointer shadow-md",onClick:()=>o(!0),children:n}),r&&h(ue,{children:[e("div",{className:"bg-transparent fixed top-0 left-0 w-screen h-screen",onClick:()=>o(!1)}),e("div",{className:"fixed z-10 mt-2",children:e(Xt,{color:t,onChange:i=>{a?.(i.hex)}})})]})]})},ur=({visible:t,calendarId:a,initialValues:n,onCancel:r,onOk:o,...s})=>{const[i]=b.useForm(),l=()=>{const c=i.getFieldsValue(!0);o?.(c?.query)},m=async c=>{const y=i.getFieldsValue(!0)?.query[c];if(y){console.log(""),Fe(`[faiz:] === start exec your query:
`,"blue"),console.log(y?.script);try{let k;y?.queryType==="simple"?k=await logseq.DB.q(y?.script):k=await logseq.DB.datascriptQuery(y.script),Fe(`[faiz:] === exec your query success:
`,"green"),console.log(k)}catch(k){Fe(`[faiz:] === exec your query failed:
`,"red"),console.error(k)}console.log("")}};return e(ie,{...s,width:980,title:"Calendar Queries (saved searches)",visible:t,onCancel:r,onOk:l,children:e("div",{className:"overflow-y-auto overflow-x-hidden",style:{maxHeight:"500px"},children:e(b,{initialValues:{query:n},form:i,size:"small",children:e(b.List,{name:"query",children:(c,{add:y,remove:k})=>h(ue,{children:[c.map((w,g)=>h("div",{className:"rounded border-dashed border-gray-200 px-4 pt-4 mb-3 relative",children:[e(b.Item,{label:`Query ${g+1}`,children:h(it,{gutter:16,children:[e(Ee,{span:12,children:e(b.Item,{label:"script",name:[w.name,"script"],labelCol:{span:4},children:e(z.TextArea,{rows:10})})}),h(Ee,{span:12,children:[e(b.Item,{label:"Query Type",name:[w.name,"queryType"],labelCol:{span:7},children:h(H.Group,{children:[e(H,{value:"simple",children:"Simple Query"}),e(H,{value:"advanced",children:"Advanced Query"})]})}),e(b.Item,{label:"Schedule Start",name:[w.name,"scheduleStart"],labelCol:{span:7},children:e(z,{})}),e(b.Item,{label:"Schedule End",name:[w.name,"scheduleEnd"],labelCol:{span:7},children:e(z,{})}),e(b.Item,{label:"Date Formatter",name:[w.name,"dateFormatter"],labelCol:{span:7},children:e(z,{})}),e(b.Item,{label:"Is Milestone",name:[w.name,"isMilestone"],labelCol:{span:7},children:h(H.Group,{children:[e(H,{value:!0,children:"Yes"}),e(H,{value:!1,children:"No"})]})})]})]})}),h("div",{className:"absolute bottom-4 right-4",children:[e(me,{title:"Execute this query in DevTools",children:e(Jt,{onClick:()=>m(g)})}),g!==0&&e(_e,{className:"ml-2",onClick:()=>k(w.name)})]})]},g)),e(b.Item,{children:e(G,{type:"dashed",size:"small",onClick:()=>y(),block:!0,icon:e(Be,{}),children:"Add Schedule Query"})})]})})})})})},mr=({value:t,onChange:a,calendarId:n})=>{const[r,o]=A.exports.useState(!1);return h("div",{children:[e(me,{title:"Edit Calendar Queries",children:e(G,{type:"link",icon:e(ea,{}),onClick:()=>o(!0)})}),e(ur,{visible:r,calendarId:n,initialValues:t,onCancel:()=>o(!1),onOk:s=>{a?.(s),o(!1)}})]})},pr=({visible:t,onCancel:a,onSave:n})=>{const[r]=b.useForm(),o=async s=>{const i=await te({originalName:s});if(console.log("[faiz:] === createAgendaPage getPage",i),i)return logseq.App.showMsg(`The page with the same name already exists
Please add properties to the page manually
agenda:: true`,"error"),{success:!0};const l=await logseq.Editor.createPage(s,{agenda:!0});return console.log("[faiz:] === createAgendaPage createPage",l),{success:!0}};return e(ie,{title:"Create Calendar",visible:t,onOk:()=>{r.validateFields().then(async s=>{const i=s.calendarId.trim();if(s.agenda){const{success:l}=await o(i);if(!l)return}n({name:i,agenda:Boolean(s.agenda)})})},onCancel:a,children:h(b,{form:r,children:[e(b.Item,{name:"calendarId",label:"Calendar ID",rules:[{required:!0}],children:e(z,{})}),e(b.Item,{name:"agenda",label:"Control By Agenda",tooltip:"Checking means that the plugin may modify this document",children:h(H.Group,{children:[e(H,{value:!0,children:"Yes"}),e(H,{value:!1,children:"No"})]})})]})})},hr=Z(Q()),Ot=async(t,a)=>{if(!Array.isArray(t))return[];const n=t?.filter(l=>l?.enabled);if(!n?.length)return[];const o=(await Promise.allSettled(n.map(l=>ta(l.url)))).map(async(l,m)=>{if(l.status==="rejected")return logseq.App.showMsg(`Get Calendar ${n[m].id} data error
${l.reason}`,"error"),[];try{const c=aa.parse(l.value.data),{events:y}=gr(c),k=y.map(async w=>{const{dtstart:g,dtend:C,summary:x,description:u}=w,p=g.type==="date-time";return await le({blockData:{id:new Date().valueOf(),content:`${x?.value||"no summary"}
${u?.value||""}`,subscription:!0},category:p?"time":"allday",start:g.value,end:C?p?C?.value:ee(ot(C?.value)):void 0,calendarConfig:n[m],defaultDuration:a,isAllDay:!p})});return Promise.all(k)}catch(c){return logseq.App.showMsg(`Parse Calendar ${n[m].id} data error
${c}`,"error"),console.log("[faiz:] === Parse Calendar error",c),[]}});return(await Promise.allSettled(o)).filter(l=>l?.status==="fulfilled").map(l=>l?.value)?.flat()},gr=t=>{function a(i){return i.reduce((l,m)=>({...l,[m[0]]:{type:m[2],value:m[3]}}),{})}const[n,r,o]=t,s=o.filter(i=>i[0]==="vevent").map(i=>{const[l,m]=i;return a(m)});return{type:n,info:a(r),events:s}},fr="_title_1beu0_1",yr="_content_1beu0_4",wr="_formBlock_1beu0_8",kr="_show_1beu0_14",br="_tabs_1beu0_19",xr="_tab_1beu0_19",vr="_active_1beu0_28";var U={title:fr,content:yr,formBlock:wr,show:kr,tabs:br,tab:xr,active:vr};const Cr=({value:t,tabs:a,onChange:n})=>{const r=t;return e("div",{className:U.tabs,children:a.map(({value:o,label:s})=>e("div",{className:M(U.tab,{[U.active]:r===o}),onClick:()=>n?.(o),children:s},o))})},Lt=[{value:"basis",label:"Basis"},{value:"calendar",label:"Calendar View"},{value:"projects",label:"Projects"},{value:"subscription",label:"Subscription"}],Ar=({...t})=>{const[a]=na.useForm(),[n,r]=A.exports.useState(Lt[0].value),[o,s]=A.exports.useState(!1),i=Q(),[,l]=j(ye),[,m]=j($e),[,c]=j(hr),y=g=>{r(g)},k=({name:g,agenda:C=!1})=>{const x=[...a.getFieldValue("calendarList"),C?Ra(g):Pa(g)];a.setFieldsValue({calendarList:x}),s(!1),w({calendarList:x},a.getFieldsValue(!0))},w=(g,C)=>{console.log("[faiz:] === onValuesChange",g,C),c(C),logseq.updateSettings({calendarList:1,subscriptionList:1}),logseq.updateSettings({subscriptionList:[],...C}),setTimeout(async()=>{if(g?.calendarList&&l(await xe()),g?.subscriptionList){const{subscriptionList:x}=await Q();m(await Ot(x))}},500)};return h("div",{className:"page-container p-8 flex flex-col items-center",children:[e("h1",{className:M(U.title,"title-text"),children:"Settings"}),h("div",{className:M(U.content,"rounded-2xl flex"),children:[h("div",{className:"flex flex-col justify-between",children:[e(Cr,{value:n,tabs:Lt,onChange:y}),e(ra,{title:h("span",{children:["Are you sure you want to restore default settings?",e("br",{}),"This is an irreversible operation."]}),onConfirm:()=>{a.setFieldsValue($),w($,$)},children:e(G,{className:"text-left",type:"link",style:{color:"var(--ls-tertiary-background-color)"},children:"Restore Defaults"})})]}),h(b,{initialValues:i,labelCol:{span:4},preserve:!0,form:a,style:{maxWidth:"800px",width:"80%"},onValuesChange:w,className:"relative h-full",children:[h("div",{id:"basis",className:M(U.formBlock,{[U.show]:n==="basis"}),children:[e(b.Item,{label:"Theme",name:"theme",children:e(F,{options:Ia})}),e(b.Item,{label:"Light Theme Type",name:"lightThemeType",children:e(F,{options:Ea})}),e(b.Item,{label:"Home Page",name:"homePage",children:e(F,{options:we})}),e(b.Item,{label:"Default Duration",name:["defaultDuration","value"],children:e(Oe,{addonAfter:e(b.Item,{name:["defaultDuration","unit"],noStyle:!0,children:e(F,{style:{width:80},options:Ba})})})}),e(b.Item,{label:"Log Key",required:!0,children:h("div",{className:"flex items-center justify-between",children:[e(b.Item,{noStyle:!0,name:["logKey","id"],rules:[{required:!0}],children:e(z,{style:{width:"240px"}})}),e(b.Item,{name:["logKey","bgColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"background"})}),e(b.Item,{name:["logKey","textColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"text"})}),e(b.Item,{name:["logKey","borderColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"border"})}),e(b.Item,{name:["logKey","enabled"],noStyle:!0,valuePropName:"checked",children:e(Le,{})})]})})]}),h("div",{id:"calendar",className:M(U.formBlock,{[U.show]:n==="calendar"}),children:[e(b.Item,{label:"Default View",name:"defaultView",rules:[{required:!0}],children:e(F,{options:mt})}),e(b.Item,{label:"Week Start Day",name:"weekStartDay",rules:[{required:!0}],children:h(F,{children:[e(F.Option,{value:0,children:"Sunday"}),e(F.Option,{value:1,children:"Monday"})]})}),e(b.Item,{label:"Time Grid",children:h("div",{className:"flex items-center",children:[e(b.Item,{noStyle:!0,name:"weekHourStart",children:e(Oe,{min:0,max:24})}),e("span",{className:"px-2",children:"-"}),e(b.Item,{noStyle:!0,name:"weekHourEnd",children:e(Oe,{min:0,max:24})})]})})]}),e("div",{id:"projects",className:M(U.formBlock,{[U.show]:n==="projects"}),children:e(b.List,{name:"calendarList",children:(g,{add:C,remove:x})=>h(ue,{children:[g.map((u,p)=>e(b.Item,{required:!0,label:p===0?"Project":"",...p===0?{}:{wrapperCol:{offset:4}},children:h("div",{className:"flex items-center justify-between",children:[e(b.Item,{name:[u.name,"id"],noStyle:!0,rules:[{required:!0}],children:e(z,{placeholder:"Calendar ID",disabled:p===0,style:{width:"240px"}})}),e(b.Item,{name:[u.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"background"})}),e(b.Item,{name:[u.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"text"})}),e(b.Item,{name:[u.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"border"})}),e(b.Item,{name:[u.name,"query"],noStyle:!0,rules:[{required:!0}],children:e(mr,{calendarId:"query"})}),e(b.Item,{name:[u.name,"enabled"],noStyle:!0,valuePropName:"checked",children:e(Le,{})}),p!==0?e(_e,{onClick:()=>x(u.name)}):e("div",{style:{width:"14px"}})]})})),e(b.Item,{wrapperCol:{offset:4},children:e(G,{type:"dashed",onClick:()=>s(!0),block:!0,icon:e(Be,{}),children:"Add Calendar"})})]})})}),e("div",{id:"subscription",className:M(U.formBlock,{[U.show]:n==="subscription"}),children:e(b.List,{name:"subscriptionList",children:(g,{add:C,remove:x})=>h(ue,{children:[g.map((u,p)=>e(b.Item,{label:p===0?"Subscription":"",...p===0?{}:{wrapperCol:{offset:4}},children:h("div",{className:"flex items-center justify-between",children:[e(b.Item,{name:[u.name,"id"],noStyle:!0,rules:[{required:!0}],children:e(z,{placeholder:"Calendar ID",style:{width:"160px"}})}),e(b.Item,{name:[u.name,"url"],noStyle:!0,rules:[{required:!0,type:"url"}],children:e(z,{placeholder:"Url",style:{width:"100px"}})}),e(b.Item,{name:[u.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"background"})}),e(b.Item,{name:[u.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"text"})}),e(b.Item,{name:[u.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:e(ae,{text:"border"})}),e(b.Item,{name:[u.name,"enabled"],noStyle:!0,valuePropName:"checked",children:e(Le,{})}),e(_e,{onClick:()=>x(u.name)})]})})),e(b.Item,{wrapperCol:{offset:4},children:e(G,{type:"dashed",onClick:()=>C(),block:!0,icon:e(Be,{}),children:"Add Subscription"})})]})})})]})]}),e(pr,{visible:o,onSave:k,onCancel:()=>s(!1)})]})},we=[{label:"Dashboard",value:"dashboard",icon:e(oa,{}),path:"/dashboard",element:e(Vn,{})},{label:"Calendar",value:"calendar",icon:e(sa,{}),path:"/calendar",element:e(ar,{})},{label:"Gantt",value:"gantt",icon:e(la,{}),path:"/gantt",element:e(sr,{})},{label:"Timeline",value:"timeline",icon:e(ia,{}),path:"/timeline",element:e(dr,{})},{label:"Settings",value:"settings",icon:e(ca,{}),path:"/settings",element:e(Ar,{})}],Dr="_container_1ph2e_1",Sr="_logo_1ph2e_6",Nr="_close_1ph2e_16";var Xe={container:Dr,logo:Sr,close:Nr};const Tr=()=>{const t=da(),{homePage:a=$.homePage}=Q(),n=r=>{const{path:o}=we.find(s=>s.value===r)||{path:"/"};t(o)};return h("div",{className:Xe.container,children:[e("div",{className:Xe.logo,children:e("img",{src:Ha})}),e(Ga,{tabs:we,onChange:n,initialValue:a}),e("div",{className:Xe.close,onClick:()=>logseq.hideMainUI(),children:e(ua,{})})]})},qr=()=>{const[,t]=j(ye),[,a]=j($e),{homePage:n=$.homePage}=Q(),r=we.find(o=>o.value===n)?.element;return A.exports.useEffect(()=>{async function o(){t(await xe());const{subscriptionList:s}=Q();a(await Ot(s))}o(),wt()},[]),A.exports.useEffect(()=>{const o=()=>logseq.hideMainUI();return kt(o),()=>{document.removeEventListener("keyup",o)}},[]),e("main",{className:"w-screen h-screen flex",prefix:"custom",children:h(ma,{children:[e(Tr,{}),h(pa,{children:[e(ct,{path:"/",element:r}),we.map(o=>e(ct,{path:o.path,element:o.element},o.value))]})]})})};const Mr=({visible:t,uuid:a,onSave:n,onCancel:r})=>{const[o,s]=A.exports.useState(!1),[i]=j(Ye),l=i.map(w=>({label:w.title,value:w?.id})),[m,c]=A.exports.useState([]),y=()=>{l.length===m.length?c([]):c(l.map(w=>w.value))},k=async()=>{let w=[];for(let g=0;g<m.length;g++){const C=await se({id:Number(m[g]?.replace("overdue-",""))});w.push(C)}logseq.Editor.insertBatchBlock(a,w.map(g=>({content:`((${g?.uuid}))`})),{before:!1,sibling:!0}),n()};return A.exports.useEffect(()=>{m?.length>0&&m.length<l.length?s(!0):s(!1)},[m?.length,l?.length]),console.log("[faiz:] === options",l,i,a),h(ie,{visible:t,title:"Insert Today Task",onCancel:r,onOk:k,children:[e(Pe.Group,{value:m,onChange:w=>c(w),children:l.map((w,g)=>e(it,{children:e(Ee,{span:24,children:e(Pe,{value:w.value,children:w.label},w.value)})}))}),e(ha,{}),e(Pe,{indeterminate:o,checked:l.length===m.length,onClick:y,children:"Check All"})]})},Ir=t=>{const[,a]=j(ye),n=t.type,r=()=>{logseq.hideMainUI()},o=()=>{logseq.hideMainUI()};return A.exports.useEffect(()=>{const s=()=>logseq.hideMainUI();return kt(s),wt(),()=>{document.removeEventListener("keyup",s)}},[]),A.exports.useEffect(()=>{async function s(){a(await xe())}n==="insertTodaySchedule"&&s()},[n]),h("div",{className:"w-screen h-screen",children:[n==="editSchedule"&&e(Et,{visible:!0,showKeepRef:!0,type:t.data.type,initialValues:t.data.initialValues,onSave:r,onCancel:o}),n==="insertTodaySchedule"&&e(Mr,{visible:!0,uuid:t.data.uuid,onSave:r,onCancel:o})]})};d.extend(ga);d.extend(fa);d.extend(ya);d.extend(wa);d.extend(ka);d.extend(ba);xa([va,Ca,Aa,Da,Sa,Na,Ta]);console.log("=== logseq-plugin-agenda loaded ==="),logseq.ready(()=>{Oa(),logseq.on("ui:visible:changed",t=>{t.visible||Re.unmountComponentAtNode(document.getElementById("root"))}),logseq.provideModel({show(){Pt(),logseq.showMainUI()}}),logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda",template:'<a data-on-click="show" class="button"><i class="ti ti-comet"></i></a>'}),logseq.App.registerCommandPalette({key:"logseq-plugin-agenda:show",label:"Show Agenda"},t=>{Pt(),logseq.showMainUI()}),logseq.Editor.registerBlockContextMenuItem("Agenda: Edit Schedule",async t=>{const a=await logseq.Editor.getBlock(t.uuid);if(console.log("[faiz:] === blockData",a),!a)return;const r=(await xe()).find(o=>Number(o.id)===a.id);if(console.log("[faiz:] === schedule",r),r)Je({type:"editSchedule",data:{type:"update",initialValues:{id:r.id,start:d(r.start),end:d(r.end),isAllDay:r?.raw?.category!=="time",calendarId:r.calendarId,title:r.raw?.content?.split?.(`
`)[0],keepRef:!0,raw:r.raw}}});else{const o=await logseq.Editor.getPage(a.page?.id);if(console.log("[faiz:] === pageData",o),!o)return logseq.App.showMsg("Failed to get page data","error");Je({type:"editSchedule",data:{type:"update",initialValues:{id:String(a.id),title:a?.content,calendarId:o?.properties?.agenda?o.originalName:void 0,isAllDay:!0,keepRef:!1}}})}logseq.showMainUI()}),logseq.Editor.registerSlashCommand("Agenda: Insert Today's Task",t=>(console.log("[faiz:] === registerSlashCommand",t),Je({type:"insertTodaySchedule",data:{uuid:t.uuid}}),logseq.showMainUI(),Promise.resolve()))});function Pt(t){xt(!1),logseq.App.onThemeModeChanged(({mode:a})=>{be(a)}),Re.render(e(dt.StrictMode,{children:e(qr,{})}),document.getElementById("root"))}function Je(t){const{type:a,data:n}=t;xt(!0),Re.render(e(dt.StrictMode,{children:e(Ir,{type:a,data:n})}),document.getElementById("root"))}
