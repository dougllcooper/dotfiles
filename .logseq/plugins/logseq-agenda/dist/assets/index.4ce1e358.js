import{r as S,j as g,a as t,f as G,p as Q,d as u,l as le,b as ee,e as ha,i as Tt,L as fa,c as V,P as Nt,F as de,g as M,B as $,S as K,u as Mt,A as Je,m as Ze,I as Xe,h as et,R as ya,k as O,n as y,M as ce,o as z,D as Ot,q as U,C as re,s as wa,T as ye,t as It,v as ka,w as ba,x as va,y as Ca,z as xa,E as Da,G as Sa,H as Et,J as tt,K as Aa,N as Me,O as Oe,Q as Ta,U as Na,V as Ma,W as Oa,X as Ia,Y as Ea,Z as at,_ as we,$ as qt,a0 as _t,a1 as jt,a2 as qa,a3 as _a,a4 as ja,a5 as Ba,a6 as La,a7 as Pa,a8 as Ha,a9 as ke,aa as Ra,ab as be,ac as Ya,ad as Fa,ae as nt,af as rt,ag as $a,ah as za,ai as Ua,aj as Wa,ak as Ga,al as Qa,am as Va,an as Ka,ao as Ie,ap as ot,aq as Ja,ar as Za,as as Xa,at as en,au as tn,av as an,aw as nn}from"./vendor.5bd55099.js";const rn=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}};rn();const ie="yyyy-MM-dd",Bt="yyyy-MM-dd EEE",on="Daily Log",ve=/^((?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])(-(?:[0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9])*/,Ee=/>\[.+\]\(#(agenda:\/\/.+)\)/,qe=/>\[\[#(agenda:\/\/.+)\]\[.+\]\]/,Lt=[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"2week",label:"2 Weeks"},{value:"month",label:"Monthly"}],sn=[{value:"light",label:"Light"},{value:"dark",label:"Dark"},{value:"auto",label:"Auto"}],ln=[{value:"green",label:"Green"},{value:"purple",label:"Purple"}],J={theme:"auto",lightThemeType:"green",homePage:"dashboard",defaultView:"month",weekStartDay:0,weekHourStart:0,weekHourEnd:24,defaultDuration:{value:.5,unit:"h"},logKey:{id:on,bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0},journal:{id:"Journal",bgColor:"#047857",textColor:"#fff",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
(not [(missing? $ ?block :block/deadline)])
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd",queryType:"advanced",isMilestone:!1},{script:`
[:find (pull
?block
[:block/uuid
  :db/id
  :block/parent
  :block/left
  :block/collapsed?
  :block/format
  :block/_refs
  :block/path-refs
  :block/tags
  :block/content
  :block/marker
  :block/priority
  :block/properties
  :block/pre-block?
  :block/scheduled
  :block/deadline
  :block/repeated?
  :block/created-at
  :block/updated-at
  :block/file
  :block/heading-level
  {:block/page
  [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}])
:where
[?block :block/page ?page]
[?page :block/journal? true]
[?block :block/marker ?marker]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]
[(missing? $ ?block :block/scheduled)]
[(missing? $ ?block :block/deadline)]]
        `,scheduleStart:"page.journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull
  ?block
  [:block/uuid
    :block/parent
    :db/id
    :block/left
    :block/collapsed?
    :block/format
    :block/_refs
    :block/path-refs
    :block/tags
    :block/content
    :block/marker
    :block/priority
    :block/properties
    :block/pre-block?
    :block/scheduled
    :block/deadline
    :block/repeated?
    :block/created-at
    :block/updated-at
    :block/file
    :block/heading-level
    {:block/page
      [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}
    {:block/refs
      [:block/journal-day]}])
  :where
  [?block :block/marker ?marker]
  [?rp :block/journal? true]
  [?block :block/refs ?rp]
  [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"refs[0].journal-day",dateFormatter:"yyyyMMdd",isMilestone:!1,queryType:"advanced"},{script:`
[:find (pull ?block [*])
:where
[?rp :block/name "milestone"]
[?block :block/scheduled]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0,queryType:"advanced"}]},projectList:[],calendarList:[],subscriptionList:[]},dn={light:{"month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#fafafa","month.day.fontSize":"16px","week.daygrid.borderRight":"1px solid #ddd","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"#a8def74d","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #ddd","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#fafafa","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"#03a9f44d","week.timegridLeft.borderRight":"1px solid #ddd","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #f9f9f9","week.timegridHorizontalLine.borderBottom":"1px solid #eee","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #ddd","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#135de6","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#808080","week.pastTime.fontWeight":"normal","week.futureTime.color":"#333","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(19, 93, 230, 0.3)","week.currentTimeLineBullet.backgroundColor":"#135de6","week.currentTimeLineToday.border":"1px solid #135de6","week.currentTimeLineFuture.border":"1px solid #135de6"},dark:{"common.backgroundColor":"#32373d","common.saturday.color":"#babec4","common.dayname.color":"#babec4","common.border":"1px solid #58595c","common.creationGuide.backgroundColor":"#32373d","month.dayname.borderLeft":"1px solid #58595c","month.holidayExceptThisMonth.color":"#f3acac","month.dayExceptThisMonth.color":"#bbb","month.weekend.backgroundColor":"#282c31","month.day.fontSize":"16px","week.vpanelSplitter.border":"1px solid #58595c","week.today.color":"#fff","week.pastDay.color":"#8f9296","week.dayname.borderTop":"1px solid #58595c","week.dayname.borderBottom":"1px solid #58595c","week.daygrid.borderRight":"1px solid #58595c","week.daygrid.backgroundColor":"inherit","week.daygridLeft.width":"77px","week.daygridLeft.backgroundColor":"rgba(252, 183, 20, 0.3)","week.daygridLeft.paddingRight":"5px","week.daygridLeft.borderRight":"1px solid #58595c","week.today.backgroundColor":"#b857d81f","week.weekend.backgroundColor":"#282c31","week.timegridLeft.width":"77px","week.timegridLeft.backgroundColor":"rgba(252, 183, 20, 0.4)","week.timegridLeft.borderRight":"1px solid #58595c","week.timegridLeft.fontSize":"12px","week.timegridLeftTimezoneLabel.height":"51px","week.timegridLeftAdditionalTimezone.backgroundColor":"#fdfdfd","week.timegridOneHour.height":"48px","week.timegridHalfHour.height":"24px","week.timegridHalfHour.borderBottom":"1px dotted #3d3e40","week.timegridHorizontalLine.borderBottom":"1px solid #58595c","week.timegrid.paddingRight":"10px","week.timegrid.borderRight":"1px solid #58595c","week.timegridSchedule.borderRadius":"0","week.timegridSchedule.paddingLeft":"0","week.currentTime.color":"#fcb714","week.currentTime.fontSize":"12px","week.currentTime.fontWeight":"bold","week.pastTime.color":"#bababd","week.pastTime.fontWeight":"normal","week.futureTime.color":"#dadade","week.futureTime.fontWeight":"normal","week.currentTimeLinePast.border":"1px solid rgba(252, 183, 20, 0.4)","week.currentTimeLineBullet.backgroundColor":"#fcb714","week.currentTimeLineToday.border":"1px solid #fcb714","week.currentTimeLineFuture.border":"1px solid #fcb714"}},Pt="yyyyMMdd",cn=[{value:"m",label:"minute"},{value:"h",label:"hour"}],Ht="Agenda",B=()=>{let e=J.logKey;const a=logseq.settings?.logKey;return a&&(e=a,typeof a=="string"&&J.logKey&&(e={...J.logKey,id:a})),{...J,...logseq.settings,logKey:e}},un=()=>{if(!logseq.settings?.initialized){const a=B();logseq.updateSettings({...a,initialized:!0}),console.log("[faiz:] === initialize settings success",logseq.settings,a)}},mn=async()=>{const e=await logseq.App.getStateFromStore("ui/theme");let a=logseq.settings?.defaultView||"month";return logseq.settings?.defaultView==="2week"&&(a="month"),{defaultView:a,taskView:!0,scheduleView:!0,useDetailPopup:!0,isReadOnly:!1,disableClick:!0,theme:dn[e],usageStatistics:!1,week:{startDayOfWeek:logseq.settings?.weekStartDay||0,hourStart:logseq.settings?.weekHourStart||0,hourEnd:logseq.settings?.weekHourEnd||24},month:{startDayOfWeek:logseq.settings?.weekStartDay||0,scheduleFilter:n=>Boolean(n.isVisible),visibleWeeksCount:logseq.settings?.defaultView==="2week"?2:void 0},template:{taskTitle:()=>'<span class="tui-full-calendar-left-content">Overdue</span>',task:n=>"\u{1F525}"+n.title,timegridDisplayPrimayTime:function(n){return n.hour<10?"0"+n.hour+":00":n.hour+":00"},popupDetailBody:n=>{const o=`<br/><b>Calendar: ${n.calendarId}</b>`,r=n.raw?.subscription?"":'<br/><a id="faiz-nav-detail" href="javascript:void(0);">Navigate To Block</a>';return`
          <div class="calendar-popup-detail-content">
            ${n.body?.split(`
`).join("<br/>")}
          </div>
          ${o}
          ${r}
        `}}}},pn=e=>({id:e,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/deadline)]
(not [(missing? $ ?block :block/scheduled)])
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?block :block/marker ?marker]
[(missing? $ ?block :block/scheduled)]
[(get-else $ ?block :block/deadline "nil") ?d]
[(not= ?d "nil")]
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE"} ?marker)]]
        `,scheduleStart:"deadline",dateFormatter:"yyyyMMdd"},{script:`
[:find (pull ?block [*])
:where
[?page :block/name ?pname]
[?block :block/page ?page]
[(contains? #{"${e}"} ?pname)]
[?rp :block/name "milestone"]
[?block :block/refs ?rp]]
        `,scheduleStart:"scheduled",dateFormatter:"yyyyMMdd",isMilestone:!0}]}),gn=e=>({id:e,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0,query:[{script:`(and (page "${e}") (task todo doing done later now waitting) (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd",queryType:"simple"},{script:`(and (page "${e}") (task todo doing done later now waitting) (property end) (property start))`,scheduleStart:"properties.start",scheduleEnd:"properties.end",dateFormatter:"yyyy-MM-dd HH:mm",queryType:"simple"},{script:`(and (page "${e}") [[milestone]] (property start))`,scheduleStart:"properties.start",dateFormatter:"yyyy-MM-dd",queryType:"simple",isMilestone:!0}]});var hn="data:image/png;base64,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";const fn="_container_1xwon_1",yn="_buttonWrapper_1xwon_4",wn="_button_1xwon_4",kn="_active_1xwon_19",bn="_indicatorBack_1xwon_23",vn="_indicatorDot_1xwon_34";var ue={container:fn,buttonWrapper:yn,button:wn,active:kn,indicatorBack:bn,indicatorDot:vn};const Cn=({initialValue:e,onChange:a,tabs:n})=>{const[o,r]=S.exports.useState(e||n?.[0]?.value),s=n.findIndex(({value:i})=>i===o)*100,l=i=>{r(i),a?.(i)};return g("div",{className:ue.container,children:[n.map(({label:i,value:c,icon:m})=>t("div",{className:ue.buttonWrapper,onClick:()=>l(c),children:t("div",{className:`${ue.button} ${c===o?ue.active:""}`,title:i,children:m})},c)),t("div",{className:ue.indicatorBack,style:{transform:`translateX(60px) translateY(${s}%)`}}),t("div",{className:ue.indicatorDot,style:{transform:`translateY(${s}%)`}})]})},xn=async(e,a)=>{const n=logseq.settings?.logKey?.id||J.logKey?.id,{preferredDateFormat:o}=await logseq.App.getUserConfigs(),r=o||Bt,s=G(Q(e,ie,new Date),r),l=G(Q(a,ie,new Date),r);return(await logseq.DB.q(`(and [[${n}]] (between [[${s}]] [[${l}]]))`))?.filter(m=>m.content?.trim()===`[[${n}]]`)?.map(m=>Array.isArray(m.parent)?m.parent:[])?.flat()?.filter(m=>(m.content?.trim()).length>0)},st=(e,a="blue")=>console.log(`%c${e}`,`color:${a}`),_e=e=>{const a=document.querySelector("html"),n=logseq.settings?.lightThemeType||J.lightThemeType,o=n==="green"?"purple":"green";e==="dark"?(a?.classList.add("dark"),a?.classList.remove(n),Yt("./antd.dark.min.css")):(a?.classList.remove("dark",o),a?.classList.add(n),Yt("./antd.min.css"))},Rt=async()=>{const{theme:e}=logseq.settings;if(e==="dark")return _e("dark");if(e==="light")return _e("light");const a=await logseq.App.getStateFromStore("ui/theme");_e(a)},Dn=e=>{const a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)},Sn=e=>{document.addEventListener("keyup",a=>{a.key==="Escape"&&e()})},An=()=>{const e=navigator.userAgent,a=e.indexOf("Windows")>-1,n=e.indexOf("Macintosh")>-1,o=e.indexOf("Linux")>-1;return a?"windows":n?"mac":o?"linux":"unknown"},Yt=e=>{const a=document.createElement("link");a.rel="stylesheet",a.href=e,a.className="antd-css";const n=document.head||document.getElementsByTagName("head")[0],o=n.childNodes[0];o?n.insertBefore(a,o):n.appendChild(a);const r=n.querySelectorAll(".antd-css");Array.from(r)?.slice(1)?.forEach(s=>{n.removeChild(s)})},Ft=e=>{const a=document.querySelector("html"),n=document.querySelector("body");e?(a?.classList.add("modal-app"),n?.classList.add("modal-app")):(a?.classList.remove("modal-app"),n?.classList.remove("modal-app"))},lt=(e=6)=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let o=0;o<e;o++)n+=a.charAt(Math.floor(Math.random()*a.length));return n},Tn=e=>{const a=new URL(e).searchParams;let n={};return a.forEach((o,r)=>n[r]=o),n},Nn=async()=>{let e=[];const a=B(),{calendarList:n=[],logKey:o,defaultDuration:r}=a,s=n.filter(d=>d?.enabled);let l=[];l=s.map(d=>d?.query?.filter(h=>h?.script?.length)?.map(h=>({calendarConfig:d,query:h}))).filter(Boolean).flat();const i=l.map(async d=>{const{query:h}=d,{script:p="",queryType:w}=h;let k=[];w==="simple"?k=await logseq.DB.q(p)||[]:k=await logseq.DB.datascriptQuery(p);const b=le.exports.flattenDeep(k).map(f=>Mn({block:f,queryWithCalendar:d,settings:a}));return Promise.all(b)}),c=await Promise.allSettled(i),m=[];if(c.forEach((d,h)=>{if(d.status==="fulfilled")m.push(d.value);else{console.error("[faiz:] === scheduleRes error: ",l[h],d);const{calendarConfig:p,query:w}=l[h],k=`Query Exec Error:
calendar: ${p.id}
query: ${w.script}
message: ${d.reason.message}`;logseq.App.showMsg(k,"error")}}),e=le.exports.flattenDeep(e.concat(m)),o?.enabled){const p=((await logseq.DB.q(`[[${o.id}]]`))?.filter(k=>(k.headingLevel&&k.format==="markdown"&&(k.content=k.content.replace(new RegExp(`^#{${k.headingLevel}} `),"")),k.content?.trim()===`[[${o.id}]]`))?.map(k=>Array.isArray(k.parent)?k.parent:[])?.flat()?.filter(k=>(k.content?.trim()).length>0&&k?.page?.journalDay&&!k.marker&&!k.scheduled&&!k.deadline)||[])?.map(async k=>{const b=k?.page?.journalDay,{start:f,end:D}=it(k?.content.replace(new RegExp(`^${k.marker} `),"")),A=f||D;return await je({blockData:k,category:A?"time":"allday",start:f?ee(Q(b+" "+f,"yyyyMMdd HH:mm",new Date)):Be(b),end:D?ee(Q(b+" "+D,"yyyyMMdd HH:mm",new Date)):void 0,calendarConfig:o,defaultDuration:r,isAllDay:!A,isReadOnly:!0})}),w=await Promise.all(p);e=e.concat(w)}return e},Mn=async({block:e,queryWithCalendar:a,settings:n})=>{const{calendarConfig:o,query:r}=a,{script:s="",scheduleStart:l="",scheduleEnd:i="",dateFormatter:c,isMilestone:m,queryType:d}=r,{defaultDuration:h}=n,p=["scheduled","deadline"].includes(l||i)?Pt:c||Bt,w=le.exports.get(e,l,void 0),k=le.exports.get(e,i,void 0);let b=/[Hhm]+/.test(p||""),f,D;try{f=w&&Be(w,p),D=k&&(b?Be(k,p):ee(ha(Q(k,p,new Date))))}catch(I){return console.warn("[faiz:] === parse calendar date error: ",I,e,r),[]}if(e?.page?.["journal-day"]){const{start:I,end:E}=it(e?.content.replace(new RegExp(`^${e.marker} `),""));if(I||E){const H=e?.page?.["journal-day"];f=I?ee(Q(H+" "+I,"yyyyMMdd HH:mm",new Date)):Be(H),D=E?ee(Q(H+" "+E,"yyyyMMdd HH:mm",new Date)):void 0,b=!0}}if(w&&["scheduled","deadline"].includes(l)){const I=e.content?.split(`
`)?.find(H=>H.startsWith(`${l.toUpperCase()}:`))?.trim(),E=/ (\d{2}:\d{2})[ >]/.exec(I)?.[1]||"";E&&(f=ee(Q(`${w} ${E}`,"yyyyMMdd HH:mm",new Date)),b=!0)}if(k&&["scheduled","deadline"].includes(i)){const I=e.content?.split(`
`)?.find(H=>H.startsWith(`${i.toUpperCase()}:`))?.trim(),E=/ (\d{2}:\d{2})[ >]/.exec(I)?.[1]||"";E&&(D=ee(Q(`${k} ${E}`,"yyyyMMdd HH:mm",new Date)),b=!0)}let A=b?"time":"allday";m&&(A="milestone");const C=A,T=$t(e,D||f,!b);!m&&T&&(A="task");const v=await je({blockData:{...e,category:C,type:"project",rawStart:f,rawEnd:D,rawAllDay:!b,rawOverdue:T},category:A,start:f,end:D,calendarConfig:o,defaultDuration:h,isAllDay:!m&&!b&&!T,isReadOnly:!0});return T?[v,{...v,id:`overdue-${v.id}`,start:u().startOf("day").toISOString(),end:u().endOf("day").toISOString(),isAllDay:!1}]:v},$t=(e,a,n)=>e.marker&&e.marker!=="DONE"&&e.marker!=="CANCELED"&&e.marker!=="WAITING"?n?u().isAfter(u(a),"day"):u().isAfter(u(a),"minute"):!1,it=e=>{const a=e.match(ve);return a?{start:a[1],end:a[2]?.slice(1)}:{start:void 0,end:void 0}},zt=(e,a,n)=>{const o=`${a}${n?"-"+n:""}`;return e.match(ve)?e.replace(ve,o):o+" "+e},Ut=e=>e.replace(ve,""),Wt=async e=>{const a=/\(\([0-9a-z\-]{30,}\)\)/;if(a.test(e)){const n=a.exec(e)?.[0]?.replace("((","")?.replace("))","");if(n){const o=await me({uuid:n},!0);return e.replace(a,o?.content||"")}}return e};async function je(e){const{id:a,blockData:n,category:o="time",start:r,end:s,calendarConfig:l,isAllDay:i,defaultDuration:c,isReadOnly:m}=e;if(!n?.id){const C=await me({uuid:n.uuid?.$uuid$},!0);C&&(n.id=C.id)}let d=n?.page;le.exports.has(d,"id")&&le.exports.has(d,"name")&&le.exports.has(d,"original-name")&&(d={id:d.id,journalDay:d["journal-day"],journal:d["journal?"],name:d.name,originalName:d["original-name"]}),n.page=d,n.fullContent=await Wt(n.content);const h=window.logseqAppUserConfigs?.preferredFormat==="org"?qe:Ee,p=n.fullContent.split(`
`)[0]?.replace(new RegExp(`^${n.marker} `),"")?.replace(ve,"")?.replace(h,"")?.replace(" #milestone","")?.trim?.(),w=n.marker==="DONE";function k(){return!!(n.page?.properties?.agenda===!0||n?.page?.["journal-day"]&&!n?.scheduled&&!n?.deadline)}const b=m===void 0?k():!m,f=c||B()?.defaultDuration;let D=s;(o==="time"||n?.category==="time")&&!s&&r&&f&&(D=u(r).add(f.value,f.unit).toISOString()),n?.category!=="time"&&!s&&(D=r);const A=typeof n?.uuid=="string"?n?.uuid:n?.uuid?.$uuid$;return n.uuid=A,{id:a||A,calendarId:l.id,title:p,body:n.fullContent,category:o,dueDateClass:"",start:r,end:D,raw:n,color:l?.textColor,bgColor:l?.bgColor,borderColor:l?.borderColor,isAllDay:i,customStyle:w?"opacity: 0.6;":"",isReadOnly:!b}}const Be=(e,a=Pt)=>ee(Q(""+e,a,new Date)),Ce=e=>({waiting:e.filter(a=>a?.addOns?.status==="waiting"),todo:e.filter(a=>a?.addOns?.status==="todo"),doing:e.filter(a=>a?.addOns?.status==="doing"),done:e.filter(a=>a?.addOns?.status==="done"),canceled:e.filter(a=>a?.addOns?.status==="canceled")}),On=e=>{const a=new Map;return e.forEach(n=>{const o=u(n.addOns.start).startOf("day").toISOString();a.has(o)||a.set(o,[]),a.get(o)?.push(n)}),a},In=({start:e,end:a,allDay:n})=>{const o=new URL("agenda://");o.searchParams.append("start",e.toISOString()),o.searchParams.append("end",a.toISOString()),n===!1&&o.searchParams.append("allDay","false");const r=n?e.format("YYYY-MM-DD"):e.format("YYYY-MM-DD HH:mm");let s=n?a.format("YYYY-MM-DD"):a.format("YYYY-MM-DD HH:mm");const l=e.isSame(a,"day");l&&n&&(s=""),l&&!n&&(s=a.format("HH:mm"));const i=r+(s?` - ${s}`:"");return window.logseqAppUserConfigs?.preferredFormat==="org"?`>[[#${o.toString()}][${i}]]`:`>[${i}](#${o.toString()})`},En=e=>{const a=window.logseqAppUserConfigs?.preferredFormat==="org"?qe:Ee,n=e.match(a);return!n||!n?.[1]?null:Tn(n[1])},qn=e=>{const a=window.logseqAppUserConfigs?.preferredFormat==="org"?qe:Ee;return e.replace(a,"")},Gt=(e,a)=>{const n=window.logseqAppUserConfigs?.preferredFormat==="org"?qe:Ee,o=In(a),r=Ut(e)?.trim();return n.test(r)?r.replace(n,o):r?.split(`
`).map((s,l)=>l===0?s+" "+o:s).join(`
`)};function Qt(e){let a=[],n=[],o=[];return e.forEach(r=>{r.addOns.isOverdue?a.push(r):r.addOns.allDay?n.push(r):o.push(r)}),{overdueTasks:a,allDayTasks:n,timeTasks:o}}const _n=e=>/ #milestone/.test(e.content)||/ #\[\[milestone\]\]/.test(e.content),Le=async(e,a,n)=>{const o=await logseq.Editor.getBlock(e);if(!o)return logseq.App.showMsg("Block not found","error"),Promise.reject(new Error("Block not found"));a&&await logseq.Editor.updateBlock(o.uuid,a);const r=Object.keys(n||{}).map(s=>logseq.Editor.upsertBlockProperty(o.uuid,s,n?.[s]));return Promise.allSettled(r)},dt=async(e,a)=>{const n=await logseq.Editor.createPage(a);return n?(await logseq.Editor.moveBlock(e,n.uuid),await me({uuid:e})):logseq.App.showMsg("Create page failed","error")},Pe=async(e,a,n)=>{const r=await me(typeof e=="number"?{id:e}:{uuid:e});if(!r)return logseq.App.showMsg("moveBlockToSpecificBlock: Block not found","error");let s=await te({originalName:a});s||(s=await logseq.Editor.createPage(a));let l=await Kt(a,n);return l||(l=await logseq.Editor.insertBlock(a,n,{before:!0,isPageBlock:!0})),l&&await logseq.Editor.moveBlock(r.uuid,l.uuid,{children:!0}),await me({uuid:r.uuid})},Vt=async(e,a,n,o={})=>{let r=await te({originalName:e});r||(r=await logseq.Editor.createPage(e));let s=await Kt(e,a);return s||(s=await logseq.Editor.insertBlock(e,a,{before:!0,isPageBlock:!0})),await logseq.Editor.insertBlock(s.uuid,n,{isPageBlock:!1,properties:o,sibling:!1,before:!1})},He=new Map,me=async(e,a=!1)=>{const{id:n,uuid:o}=e,r=n||o;if(!r)return Promise.reject(new Error("getBlockData: id or uuid is required"));if(a&&He.has(r))return He.get(r);const s=await logseq.Editor.getBlock(r);if(!s)return null;const{id:l,uuid:i}=s;return He.set(l,s),He.set(i,s),s},xe=new Map,te=async(e,a,n=!1)=>{const{id:o,uuid:r,originalName:s}=e,l=o||r||s;if(!l)return Promise.reject(new Error("getPageData: id, uuid or pageOriginalName is required"));if(n&&xe.has(l))return xe.get(l);const i=await logseq.Editor.getPage(l,a);if(!i)return null;const{id:c,uuid:m,originalName:d}=i;return xe.set(c,i),xe.set(m,i),xe.set(d,i),i},jn=async()=>{const e=await logseq.App.getStateFromStore("ui/theme"),a=logseq.settings?.theme==="auto"?e:logseq.settings?.theme,n=logseq.settings?.lightThemeType||"green";return a==="dark"?"dark":n},Kt=async(e,a)=>(await logseq.Editor.getPageBlocksTree(e)).find(r=>r.content===a)||null,Bn=e=>{const{calendarList:a}=B();return a?.filter(n=>n.enabled).some(n=>n.id===e)},Ln=e=>{let a=null;for(let n=0;n<e.length;n++){const o=e[n],r=o.getAttribute("blockid");if(o?.className?.includes("block-content")&&r){a=r;break}n++}return a},Jt=(e,a)=>{const n=e.marker,o=e.priority;return(a||e.content)?.replace(n,"").trim().replace(`[#${o}]`,"").trim()},ct=(e,a)=>{const n=e.marker,o=e.priority;let r=a;return o&&(r=`[#${o}] `+r),n&&(r=n+" "+r),r};function pe(){const[e,a]=S.exports.useState(J.lightThemeType);return S.exports.useEffect(()=>{jn().then(n=>{console.log("[faiz:] === getCurrentTheme",n),a(n)})}),e}const Pn={green:{lineColor:"#058f68",backColor:"rgba(5, 143, 104, 0.8)",backColorEnd:"rgba(255,255,255,0)"},purple:{lineColor:"#3a4de9",backColor:"rgba(58,77,233,0.8)",backColorEnd:"rgba(255,255,255,0)"},dark:{lineColor:"#d19811",backColor:"rgba(148, 108, 12, 0.8)",backColorEnd:"rgba(33, 37, 40, 0.8)"}},Hn={green:{backColor:"#e9f2f0",lineColor:"#058f68",shadowColor:"rgba(5, 143, 104, 0.8)",colorPrimary:"#333",colorSecondary:"#777"},purple:{backColor:"#f2f6ff",lineColor:"#5146a0",shadowColor:"rgba(58,77,233,0.8)",colorPrimary:"#333",colorSecondary:"#777"},dark:{backColor:"#212528",lineColor:"#d19811",shadowColor:"rgba(33, 37, 40, 0.8)",colorPrimary:"#fafafe",colorSecondary:"#aaadb3"}},Rn=An(),Zt=({progress:e=0,uniqueId:a="",height:n=160,type:o="primary"})=>{const r=S.exports.useRef(),s=pe();return S.exports.useEffect(()=>{const l=document.getElementById("gauge"+a);async function i(){if(!l||!s)return;const c=Hn[s],m=o==="normal"?20:60,d=o==="normal"?4:7,h={series:[{type:"gauge",startAngle:90,endAngle:-270,min:0,max:100,splitNumber:12,grid:{left:"0",right:"0",bottom:"0",containLabel:!0},itemStyle:{color:c.lineColor,shadowColor:c.shadowColor,shadowBlur:o==="normal"?3:10,shadowOffsetX:o==="normal"?0:2,shadowOffsetY:o==="normal"?0:2},progress:{show:!0,roundCap:!0,width:d},pointer:{show:!1},axisLine:{roundCap:!0,lineStyle:{width:d,color:[[1,c.backColor]]}},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},title:{show:!1},detail:{show:!0,width:m,height:m,lineHeight:m+(Rn==="windows"?4:0),borderRadius:100,offsetCenter:[0,0],valueAnimation:!0,formatter:function(p){return"{value|"+p.toFixed(0)+"}{unit|%}"},rich:{value:{fontSize:o==="normal"?15:34,color:c.colorPrimary},unit:{fontSize:o==="normal"?10:15,color:c.colorSecondary,padding:o==="normal"?[0,0,-2,1]:[0,0,-8,2]}}},data:[{value:e}]}]};window.requestAnimationFrame(()=>{const p=Tt(l);r.current=p,p.setOption(h)})}return i(),()=>{r.current&&r.current.dispose()}},[e,s]),t("div",{children:t("div",{id:"gauge"+a,style:{width:"100%",height:n+"px"}})})},Yn=({data:e})=>{const a=S.exports.useRef(),n=pe();return console.log("[faiz:] === Polygonal theme",n),S.exports.useEffect(()=>{const o=document.getElementById("polygonal");async function r(){if(!o||!n)return;const s=Pn[n],l={xAxis:{type:"category",data:e.map(i=>{const c=u(i.date).format("DD");return c==="01"?u(i.date).format("MM.DD"):c}),axisTick:{show:!1},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{show:!1},minInterval:1},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},series:[{data:e.map(i=>i.value),type:"line",smooth:!0,emphasis:{focus:"series"},showSymbol:!1,itemStyle:{color:s.lineColor},areaStyle:{color:new fa(0,0,0,1,[{offset:0,color:s.backColor},{offset:1,color:s.backColorEnd}])}}]};window.requestAnimationFrame(()=>{const i=Tt(o);a.current=i,i.setOption(l)})}return r(),()=>{a.current&&a.current.dispose()}},[e,n]),t("div",{id:"polygonal",style:{height:"240px",width:"100%"}})},Xt=`
  .external-link[href^="#agenda://"]::before {
    content: '\u{1F4C5}';
    margin: 0 4px;
  }
  .agenda-sidebar-task__add {
    display: none;
  }
  .agenda-sidebar-task:hover {
    opacity: 1;
  }
  .agenda-sidebar-task:hover .agenda-sidebar-task__add {
    display: flex;
  }
  .agenda-sidebar-task:hover .agenda-sidebar-task__title {
    color: var(--ls-link-text-color);
  }
`,Re={bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857"},Ye=e=>{const{journal:a,projectList:n=[]}=B();let o=e?.addOns?.allDay?"allday":"time";e?.addOns?.isOverdue&&(o="task");let r=e?.addOns?.isJournal?a:n.find(s=>s.id===e?.page?.originalName);return r||(r=Re),{id:e.uuid,calendarId:e.addOns.isJournal?"Journal":e.page?.originalName,title:e.addOns.showTitle,body:e.content,category:o,dueDateClass:"",start:e.addOns.start,end:e.addOns.end,raw:e,color:r?.textColor,bgColor:r?.bgColor,borderColor:r?.borderColor,isAllDay:!e?.addOns?.isOverdue&&e.addOns.allDay,customStyle:e.addOns.status==="done"?"opacity: 0.6;":"",isReadOnly:!1}},Fe=e=>{const{journal:a,projectList:n=[]}=B();let o=e?.addOns?.isJournal?a:n.find(r=>r.id===e?.page?.originalName);return o||(o=Re),{id:e.uuid,calendarId:e.addOns.isJournal?"Journal":e.page?.originalName,title:e.addOns.showTitle,body:e.content,category:"milestone",dueDateClass:"",start:e.addOns.start,end:e.addOns.end,raw:e,color:o?.textColor,bgColor:o?.bgColor,borderColor:o?.borderColor,isAllDay:!1,customStyle:e.addOns.status==="done"?"opacity: 0.6;":"",isReadOnly:!1}},ea=e=>{const a=u(e.addOns.start),n=u(e.addOns.end);return{id:e.uuid,title:e.addOns.showTitle,start:a.format("YYYY-MM-DD"),end:n.format("YYYY-MM-DD"),raw:e,detailPopup:g("div",{className:"text-xs",children:[t("div",{className:"font-bold text-base my-2",children:e.addOns.showTitle}),t("div",{className:"my-2",children:`${a.format("YYYY.MM.DD hh:mm a")} - ${n.format("hh:mm a")}`}),t("p",{className:"whitespace-pre-line",children:e.content}),t("a",{onClick:async()=>{const{id:o,originalName:r}=e||{};let s=r;s||(s=(await te({id:o}))?.originalName),logseq.Editor.scrollToBlockInPage(s,e.uuid),logseq.hideMainUI()},children:"Navigate to block"})]})}},ge=async(e,a)=>{const{defaultDuration:n,journal:o,projectList:r}=a,s=e?.page?.originalName?e.page:await logseq.Editor.getPage(e.page.id);e.page=s;const l=Fn(e),i=_n(e),c=Boolean(s?.journalDay);let m=l?{...e,rawTime:l,addOns:{showTitle:"",end:"",status:"todo",isOverdue:!1,isJournal:!1,type:"task",...l}}:{...e,addOns:{showTitle:"",status:"todo",isOverdue:!1,isJournal:!1,type:"task"}},d=Jt(e);if(l?.timeFrom==="customLink"&&(d=qn(d.trim())),l?.timeFrom==="journal"&&!l?.allDay&&(d=Ut(d.trim())),l?.timeFrom==="refs"){const{preferredDateFormat:p}=await logseq.App.getUserConfigs(),w=G(u(l.start).valueOf(),p);d=d.replace(`[[${w}]]`,"")?.trim()}m.addOns.showTitle=await Wt(d?.split(`
`)?.[0]?.trim()),l&&!l.end&&(l.allDay?m.addOns.end=l.start:m.addOns.end=u(m.addOns.start).add(n.value,n.unit).toISOString()),["DOING","NOW"].includes(e.marker)?m.addOns.status="doing":e.marker==="WAITING"?m.addOns.status="waiting":e.marker==="DONE"?m.addOns.status="done":e.marker==="CANCELED"&&(m.addOns.status="canceled"),l&&$t(e,m.addOns.end,l?.allDay)&&(m.addOns.isOverdue=!0),c&&(m.addOns.isJournal=!0);const h=r?.find(p=>p.id===s.originalName);return h?m.addOns.calendarConfig=h:c?m.addOns.calendarConfig=o:m.addOns.calendarConfig={id:s?.originalName,enabled:!0,...Re},i&&(m.addOns.type="milestone"),m},Fn=e=>{const{start:a,end:n}=e.properties||{};if(a&&n)return a?.length>=16?{start:u(a,"YYYY-MM-DD HH:mm").toISOString(),end:u(n,"YYYY-MM-DD HH:mm").toISOString(),allDay:!1,timeFrom:"startProperty"}:{start:u(a,"YYYY-MM-DD").toISOString(),end:u(n,"YYYY-MM-DD").toISOString(),allDay:!0,timeFrom:"startProperty"};const o=En(e.content);if(o)return{start:o.start,end:o.end,allDay:o.allDay!=="false",timeFrom:"customLink"};if(e.scheduled){const l=e.content?.split(`
`)?.find(c=>c.startsWith("SCHEDULED:"))?.trim(),i=/ (\d{2}:\d{2})[ >]/.exec(l)?.[1]||"";return i?{start:u(`${e.scheduled} ${i}`,"YYYYMMDD HH:mm").toISOString(),allDay:!1,timeFrom:"scheduledProperty"}:{start:u(""+e.scheduled,"YYYYMMDD").toISOString(),allDay:!0,timeFrom:"scheduledProperty"}}if(e.deadline){const l=e.content?.split(`
`)?.find(c=>c.startsWith("DEADLINE:"))?.trim(),i=/ (\d{2}:\d{2})[ >]/.exec(l)?.[1]||"";return i?{start:u(`${e.deadline} ${i}`,"YYYYMMDD HH:mm").toISOString(),allDay:!1,timeFrom:"deadlineProperty"}:{start:u(""+e.deadline,"YYYYMMDD").toISOString(),allDay:!0,timeFrom:"deadlineProperty"}}const r=e.refs?.find(l=>Boolean(l?.journalDay));if(r)return{start:u(r?.journalDay+"","YYYYMMDD").toISOString(),allDay:!0,timeFrom:"refs"};if(Boolean(e?.page?.journalDay)){const l=Jt(e),{start:i,end:c}=it(l);return i&&c?{start:u(`${e?.page?.journalDay} ${i}`,"YYYYMMDD HH:mm").toISOString(),end:u(`${e?.page?.journalDay} ${c}`,"YYYYMMDD HH:mm").toISOString(),allDay:!1,timeFrom:"journal"}:i&&!c?{start:u(`${e?.page?.journalDay} ${i}`,"YYYYMMDD HH:mm").toISOString(),allDay:!1,timeFrom:"journal"}:{start:u(e?.page?.journalDay+"","YYYYMMDD").toISOString(),allDay:!0,timeFrom:"journal"}}return null},De=()=>({tasks:{withTime:[],noTime:[]},milestones:{withTime:[],noTime:[]}}),ut=async()=>{let e=await logseq.DB.datascriptQuery(`
  [:find (pull
    ?block
    [:block/uuid
      :block/parent
      :db/id
      :block/left
      :block/collapsed?
      :block/format
      :block/_refs
      :block/path-refs
      :block/tags
      :block/content
      :block/marker
      :block/priority
      :block/properties
      :block/pre-block?
      :block/scheduled
      :block/deadline
      :block/repeated?
      :block/created-at
      :block/updated-at
      :block/file
      :block/heading-level
      {:block/page
        [:db/id :block/name :block/original-name :block/journal-day :block/journal?]}
      {:block/refs
        [:block/journal-day]}])
    :where
    [?block :block/marker ?marker]
    [(contains? #{"TODO" "DOING" "NOW" "LATER" "WAITING" "DONE" "CANCELED"} ?marker)]]
  `);if(!e||e?.length===0)return null;e=e.flat();const a=B();let n=De(),o=De();const r=new Map,s=e.map(async l=>{l={...l,uuid:l.uuid?.$uuid$,page:{...l.page,originalName:l.page?.["original-name"],journalDay:l.page?.["journal-day"]},refs:l.refs?.map(h=>({...h,journalDay:h?.["journal-day"]}))};const i=await ge(l,a),c=i.addOns.type==="milestone",m=i.rawTime,d=i.addOns.isJournal;if(c?m?n.milestones.withTime.push(i):n.milestones.noTime.push(i):m?n.tasks.withTime.push(i):n.tasks.noTime.push(i),d)c?m?o.milestones.withTime.push(i):o.milestones.noTime.push(i):m?o.tasks.withTime.push(i):o.tasks.noTime.push(i);else{const h=l.page?.originalName,p=r.get(h)||De();c?m?p.milestones.withTime.push(i):p.milestones.noTime.push(i):m?p.tasks.withTime.push(i):p.tasks.noTime.push(i),r.set(h,p)}});return await Promise.all(s),{journalEvents:o,projectEventsMap:r,fullEvents:n}},he=V(De()),Se=V(De()),Ae=V(new Map),mt=V(e=>{const a=e(he),n=a.tasks.withTime.map(Ye),o=a.milestones.withTime.map(Fe);return n.concat(o)}),$n=V(e=>{const{journal:a}=B(),n=e(mt);return{calendarConfig:a,schedules:n.filter(({calendarId:o})=>o==="Journal")}}),zn=V(e=>{const{projectList:a=[]}=B(),n=e(mt);return a?.map(o=>({calendarConfig:o,schedules:n.filter(({calendarId:r})=>r===o.id)}))}),Un=V(e=>{const a=e(he),n=u().subtract(14,"day"),o=u();return a.tasks.withTime.filter(r=>u(r.start).isBetween(n,o,"day","(]"))}),$e=V(e=>e(he).tasks.withTime.filter(n=>{if(n.addOns.status==="canceled")return!1;if(n.addOns.isOverdue)return!0;const o=u(n.addOns.start),r=u(n.addOns.end);return u().isBetween(o,r,"day","[]")}).sort((n,o)=>u(n.addOns.start).diff(u(o.addOns.start)))),ze=V(e=>{const{projectList:a=[],journal:n}=B();return([n].concat(a)?.filter(s=>s?.enabled)).map(s=>{const l=s.id,i=s.id==="Journal"?e(Se):e(Ae).get(l),c=s.id==="Journal"?n:a.find(p=>p.id===l);if(!i)return{id:l,title:l,amount:{doing:0,todo:0,done:0},style:{bgColor:s.bgColor||"#fff",borderColor:s.borderColor||"#fff",color:s.textColor||"#000"},events:[],milestones:[]};const{doing:m,todo:d,done:h}=Ce(i?.tasks?.withTime);return{id:l,title:l,amount:{doing:m?.length,todo:d?.length,done:h?.length},style:{bgColor:c?.bgColor||"#fff",borderColor:c?.borderColor||"#fff",color:c?.textColor||"#000"},events:i.tasks.withTime.map(ea),milestones:i.milestones.withTime.map(ea)}}).filter(function(s){return Boolean(s)})}),ta=36,oe=40,Ue=30,Wn={day:108,week:44,month:20},Gn=[{value:"simple",label:"Simple"},{value:"advanced",label:"Advanced"}],Qn=[{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"}],pt=(e,a)=>{const n=[];let o=e;for(;o.isSameOrBefore(a);)n.push(o.clone()),o=o.add(1,"day");return n},aa=e=>e.day()===0||e.day()===6,Vn=(e,a="simple")=>{let n=[];return e.forEach((o,r)=>{const s=n[r-1],{levelCount:l=0,events:i=[],milestones:c=[]}=s||{},m=a==="simple"?l:i.length,d=a==="simple"?c.length>0?1:0:c.length,h=r===0?0:s.coordinate.y+(m+d)*oe+ta+Ue;n.push({...o,coordinate:{x:0,y:h}})}),n},na=(e,a,n)=>a.diff(e,"day")*n,We=(e,a="")=>{document.querySelector(`#date${a}${e.format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"})},Kn=e=>e.map(a=>ra(a)),Jn=e=>e.map(a=>Zn(a)),Zn=e=>{const{events:a,rangeStart:n,rangeEnd:o}=ra(e);let r=oa(a,[],u(n),u(o));return{...e,levelCount:r.length,events:r.map((s,l)=>s.map(i=>({...i,level:l}))).flat()}},ra=e=>{const{events:a,milestones:n}=e;a.sort((c,m)=>u(c.start).diff(u(m.start)));let o=new Map;a.forEach(c=>{const{start:m}=c;o.has(m)?o.get(m)?.push(c):o.set(m,[c])}),o.forEach(c=>{c.sort((m,d)=>{const h=u(m.end).diff(u(m.start),"day");return u(d.end).diff(u(d.start),"day")-h})});const r=Array.from(o.values()),s=r[0]?.[0]?.start,l=r[r.length-1]?.[0]?.end,i=r.flat();return{...e,events:i,milestones:n?.sort((c,m)=>u(c.start).diff(u(m.start))),rangeStart:s,rangeEnd:l}};function Xn(e,a){const n=new Map;return pt(e,a).forEach(o=>{n.set(o.format("YYYY-MM-DD"),!1)}),n}function oa(e=[],a=[],n,o){const r=Xn(u(n),u(o)),s=[],l=[];return e.forEach(i=>{const{start:c,end:m}=i,d=u(c),h=u(m),p=pt(d,h).map(w=>w.format("YYYY-MM-DD"));r.get(d.format("YYYY-MM-DD"))===!1?(p.forEach(w=>{r.set(w,!0)}),s.push(i)):l.push(i)}),a.push(s),l?.length===0?a:oa(l,a,n,o)}const er=e=>{const a=e.map(r=>{const{events:s,milestones:l=[]}=r;return[...s,...l]}).flat();let n=u(),o=u();return a.forEach(r=>{const{start:s,end:l}=r;u(s).isBefore(n)&&(n=u(s)),u(l).isAfter(o)&&(o=u(l))}),{start:n,end:o}},tr=({data:e,mode:a="simple",view:n="day",weekStartDay:o=0,uniqueId:r=""},s)=>{const l=u(),{start:i,end:c}=er(e),m=i.subtract(1,"day"),d=c.add(9,"day"),h=Wn[n],p=pt(m,d),k=Vn(e,a).map((f,D)=>{const{events:A,milestones:C=[]}=f,T=a==="simple"?(f.levelCount||0)*oe:A.length*oe,v=a==="simple"?(C.length>0?1:0)*oe:C.length*oe,I=T+v+Ue;return{...f,height:I,events:f.events.map((E,H)=>{const ae=a==="simple"?E?.level||0:H;return{...E,coordinates:{x:na(m,u(E.start),h),y:f.coordinate.y+ae*oe},size:{width:h*(u(E.end).diff(u(E.start),"day")+1)-8,height:oe-4}}}),milestones:f.milestones?.map((E,H)=>{const ae=a==="simple"?0:H;return{...E,coordinates:{x:na(m,u(E.start),h),y:f.coordinate.y+T+ae*oe}}})}}),b=k.reduce((f,D)=>f+D.height+ta,0);return console.log("[faiz:] === dataWithCoordinates",k),S.exports.useEffect(()=>{document.querySelector(`#date${r}${u().format("YYYYMMDD")}`)?.scrollIntoView({block:"nearest",inline:"center"})},[]),S.exports.useImperativeHandle(s,()=>({scrollToToday(){We(u(),r)}})),g("div",{className:"calendar h-fit w-fit",children:[t("div",{className:"w-fit whitespace-nowrap bg-quaternary sticky top-0 z-20 text",children:p.map(f=>{const A=f.format("DD")==="01"||f.isSame(m,"day")||f.isSame(d,"day");return t("div",{className:"inline",children:t("span",{className:"inline-block text-center sticky bg-quaternary overflow-visible box-content",style:{width:`${h}px`,left:0,lineHeight:"25px",paddingRight:"100px",marginRight:"-100px"},children:A?f.format("MMMM YYYY"):""})},"month"+f.valueOf())})}),t("div",{className:"calendar__header w-fit whitespace-nowrap bg-quaternary sticky z-20",style:{top:"25px"},children:p.map(f=>{const D=f.format("DD"),A=aa(f),C=f.isSame(l,"day");let T=!0;return n==="month"&&(T=f.day()===o||C),t("div",{className:`calendar__date inline-flex ${A?"weekend":""} ${C?"today":""}`,id:"date"+r+f.format("YYYYMMDD"),children:t("span",{className:`inline-block text-center ${T?"":"opacity-0"}`,style:{width:"108px"},children:D})},"date"+f.valueOf())})}),t("div",{className:"calendar__content relative",style:{height:b+"px"},children:k.map(f=>g("div",{className:"calendar__group w-fit",children:[t("div",{className:"flex",children:p.map((D,A)=>{const C=aa(D),T=D.isSame(l,"day");return t("div",{className:`calendar__content__back ${C?"weekend":""} ${T?"today":""}`,style:{height:f.height+"px"}})})}),f.events.map(D=>{const{coordinates:A,size:C,detailPopup:T}=D;return t(Nt,{content:T,trigger:"click",children:t("div",{className:"calendar__event absolute bg-quaternary rounded cursor-pointer single_ellipsis shadow",style:{left:A.x,top:A.y+Ue,width:C.width+"px",height:C.height+"px",zIndex:1},title:D.title,children:D.title},D.id)})}),f.milestones?.map(D=>{const{coordinates:A,detailPopup:C}=D;return g(de,{children:[t("div",{className:"calendar__milestone__line absolute",style:{left:A.x+h/2,top:f.coordinate.y,height:f.height+16}},"milestone-line"+D.id),t(Nt,{content:C,trigger:"click",children:t("div",{className:"calendar__milestone__text absolute flex items-center cursor-pointer",style:{left:A.x+2+h/2,top:A.y+Ue},title:D.title,children:t("span",{className:"single_ellipsis",style:{maxWidth:h-20},children:D.title})},"milestone-text"+D.id)})]})})]},f.id))})]})};var ar=S.exports.forwardRef(tr);const nr=({groupName:e,events:a,milestones:n=[],mode:o,levelCount:r=0,uniqueId:s=""})=>g("div",{className:"group rounded-sm",children:[t("div",{className:"group__title font-medium sticky bg-quaternary title-text",children:e}),g("div",{className:"group__content",children:[o==="simple"?new Array(r).fill(0).map((l,i)=>t("div",{className:"group__event cursor-pointer"})):a.map(l=>t("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>We(u(l.start),s),children:l?.title})),o==="simple"?n?.length>0?t("div",{className:"group__event cursor-pointer flex justify-between items-center"}):null:n?.map((l,i)=>t("div",{className:"group__event cursor-pointer single_ellipsis",onClick:()=>We(u(l.start),s),children:l?.title}))]})]});const Ge=({weekStartDay:e,data:a,showSidebar:n=!0,showOptions:o=!0,defaultView:r="day",defaultMode:s="simple",showModeSelector:l=!1,theme:i="light",uniqueId:c="",...m})=>{const d=S.exports.useRef(),[h,p]=S.exports.useState(r),[w,k]=S.exports.useState(s),b=w==="simple"?Jn(a):Kn(a);return g("div",{className:M(`w-full h-full relative gantt text view-${h}`,{dark:i==="dark"},{light:i!=="dark"}),...m,children:[n&&t("div",{className:"calendar__placeholder absolute bg-quaternary"}),o&&g("div",{className:"operation absolute right-0 top-0 z-30 bg-quaternary",children:[t($,{size:"small",shape:"round",onClick:()=>We(u(),c),children:"Today"}),t(K,{size:"small",options:Qn,defaultValue:h,onChange:f=>p(f),style:{minWidth:"80px"},className:"ml-2 select-style"}),l&&t(K,{size:"small",options:Gn,defaultValue:"simple",onChange:f=>k(f),style:{minWidth:"110px"},className:"ml-2 select-style"})]}),g("div",{className:"flex h-full overflow-auto relative scroll-style",children:[n&&t("div",{className:"side-bar bg-quaternary sticky left-0 z-10 h-fit",children:b.map((f,D)=>t(nr,{mode:w,groupName:f.title,events:f?.events,milestones:f?.milestones,levelCount:f.levelCount,uniqueId:c},f.id))}),t(ar,{data:b,ref:d,mode:w,view:h,uniqueId:c})]})]})},rr="_content_zjaco_1",or="_stats_zjaco_4",sr="_statsRight_zjaco_7",lr="_amount_zjaco_10",ir="_project_zjaco_15",dr="_projectContent_zjaco_18",cr="_milestone_zjaco_22",ur="_timeline_zjaco_26",mr="_showTimeline_zjaco_26",pr="_option_zjaco_39",gr="_rightSide_zjaco_43",hr="_taskLine_zjaco_49",fr="_module_zjaco_52",yr="_task_zjaco_49",wr="_taskDone_zjaco_66",kr="_taskActive_zjaco_69",br="_time_zjaco_26",vr="_overdue_zjaco_92",Cr="_subscription_zjaco_95";var j={content:rr,stats:or,statsRight:sr,amount:lr,project:ir,projectContent:dr,milestone:cr,timeline:ur,showTimeline:mr,option:pr,rightSide:gr,taskLine:hr,module:fr,task:yr,taskDone:wr,taskActive:kr,time:br,overdue:vr,subscription:Cr};function xr(e){const{milestones:a=[]}=e;if(a?.length===0)return null;const n=a.filter(o=>u(o.start).isSameOrAfter(u(),"day"));return n.length===0?null:n.sort((o,r)=>u(o.start).diff(u(r.start)))?.[0]}const Dr=({data:e})=>{const[a,n]=S.exports.useState(!1),o=pe(),r=Mt(),s=xr(e),l=e?.amount?.doing||0,i=e?.amount?.todo||0,c=e?.amount?.done||0,m=l+i+c,d=m===0?0:c/m,h=async w=>{console.log("[faiz:] === milestone",w);const{raw:k={},start:b,end:f,id:D="",title:A=""}=w,C=k?.blockData,{id:T,originalName:v}=C?.page||{};let I=v;I||(I=(await te({id:T}))?.originalName);const{uuid:E}=await logseq.Editor.getBlock(C.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(I,E),logseq.hideMainUI()},p=async()=>{const w=e.id;await te({originalName:w}),r(`/project/${w}`)};return g("div",{className:M(j.project),children:[g("div",{className:M("flex flex-col flex-1 w-0",j.projectContent,{[j.expand]:a}),children:[g("div",{className:"flex justify-between items-center h-24 p-3",children:[g("div",{className:"h-full flex items-center cursor-pointer",onClick:p,children:[t("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-lg font-medium",style:{backgroundColor:e?.style?.bgColor,color:e?.style?.color},children:e.title?.[0]?.toUpperCase()}),g("div",{className:"ml-3",children:[t("div",{className:"text-lg title-text",children:e.title}),t("div",{className:"mt-1 description-text",children:`doing: ${e?.amount?.doing||0} todo: ${e?.amount?.todo||0} done: ${e?.amount?.done||0}`})]})]}),g("div",{className:"h-full flex items-center",children:[t("div",{style:{width:"4.375rem"},children:t(Zt,{progress:parseInt(""+d*100),uniqueId:e.id,height:70,type:"normal"})}),s&&g("div",{className:M("flex flex-col items-center justify-center d h-full pl-3 pr-1 ml-3 cursor-pointer",j.milestone),onClick:()=>h(s),children:[g("div",{className:"text-center",children:[t("span",{className:"text-3xl title-text",children:u(s.start).format("DD")}),t("span",{className:"text-xs description-text ml-1",children:u(s.start).format("MMM")})]}),g("span",{className:"text-xs description-text",children:["days left: ",u(s.start).diff(u(),"day"),"d"]}),t("span",{className:"text-xs description-text ellipsis w-full text-center",title:s.title,children:s.title})]})]})]}),t(Je,{children:a&&t(Ze.div,{className:M(j.timeline,{[j.showTimeline]:a}),initial:{opacity:0,height:0},animate:{opacity:1,height:"auto",marginTop:"0.5rem",padding:"0.75rem"},exit:{opacity:0,height:0,marginTop:0,padding:0},transition:{ease:"easeInOut",duration:.2},children:t(Ge,{data:[e],weekStartDay:0,showOptions:!1,showSidebar:!1,defaultView:"week",theme:o,uniqueId:e?.id})})})]}),t("div",{className:M(j.option,"text w-10 h-10 rounded-full flex justify-center items-center shadow-sm text-lg ml-3 cursor-pointer"),onClick:()=>n(!a),children:t("div",{className:"flex items-center",children:a?t(Xe,{}):t(et,{})})})]})};function Sr(e,a=!1){const n=e?.addOns.start,o=e?.addOns.end,r=u(n),s=u(o),l=r.isSame(s,"day");return a?e.addOns.allDay?l?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:l&&r.isSame(u(),"day")?{start:r.format("HH:mm"),end:s.format("HH:mm")}:l?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:l?e.addOns.allDay?{start:"all-day"}:{start:r.format("HH:mm"),end:s.format("HH:mm")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}}const gt=({task:e,showTimeDot:a=!1,type:n="allDay"})=>{const o=u(e.addOns.start),r=u(e.addOns.end);o.isSame(r,"day");const s=n!=="overdue"&&u().isBetween(o,r),l=e?.addOns.status==="done",i=e.addOns.calendarConfig,{start:c,end:m}=Sr(e,n==="overdue");return g("div",{className:M(j.task,{[j.taskActive]:s,[j.taskDone]:l},j?.[n],"flex pl-5 pr-4 py-2 items-center justify-between"),children:[a&&t("div",{className:M(j.time),children:t("span",{children:o?.format("HH:mm")})}),t("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:i?.bgColor,color:i?.textColor},title:i?.id,children:i?.id?.[0]?.toUpperCase()}),g("div",{className:"flex flex-col flex-1 ellipsis mx-4",children:[t("span",{className:"ellipsis text",children:e.addOns.showTitle}),g("div",{className:M(j.subscription,"text-xs flex justify-between"),children:[t("span",{className:"description-text",children:m?`${c} - ${m}`:c}),t("span",{className:"ml-2 ellipsis #6b531a",title:i?.id,children:i?.id})]})]}),t("div",{className:"w-5 h-5 cursor-pointer text",onClick:async()=>{const{id:d,originalName:h}=e?.page||{};let p=h;p||(p=(await te({id:d}))?.originalName),logseq.Editor.scrollToBlockInPage(p,e.uuid),logseq.hideMainUI()},children:t(ya,{})})]})},Ar=()=>{const[e]=O($e),{overdueTasks:a,allDayTasks:n,timeTasks:o}=Qt(e);return g("div",{className:j.taskLine,children:[a.length>0&&g("div",{className:j.module,children:[t("span",{children:"Overdue"}),a.map(r=>t(gt,{task:r,type:"overdue"},r.id))]}),n.length>0&&g("div",{className:j.module,children:[t("span",{children:"All Day"}),n.map(r=>t(gt,{task:r,type:"allDay"},r.id))]}),o.length>0&&g("div",{className:j.module,children:[t("span",{children:"Time"}),o.map(r=>t(gt,{task:r,type:"time",showTimeDot:!0},r.id))]})]})};function Tr(){const[e]=O(Un),a=On(Ce(e)?.done),n=u().subtract(13,"day").startOf("day"),o=[n];for(let r=1;r<14;r++)o.push(n.add(r,"day"));return o.map(r=>{const s=a.get(r.toISOString());return{date:r.toISOString(),value:s?.length||0}})}const Nr=()=>{const e=Tr(),[a]=O(ze),n=a||[],[o]=O($e),r=Ce(o),s=r?.todo?.length+r?.doing?.length,l=r?.done?.length,i=s+l,c=i===0?0:parseInt(l/i*100+""),m=async()=>{const{preferredDateFormat:d}=await logseq.App.getUserConfigs(),h=G(Q(u().format("YYYY-MM-DD"),ie,new Date),d);logseq.App.pushState("page",{name:h}),logseq.hideMainUI()};return g("div",{className:"page-container flex",children:[g("div",{className:M(j.content,"flex flex-col flex-1 p-8"),children:[t("h1",{className:"title-text",children:"Dashboard"}),g("div",{className:"flex-1 overflow-auto",children:[g("div",{className:M(j.stats,"flex"),children:[t("div",{className:"flex-1",children:t(Yn,{data:e})}),g("div",{style:{width:"160px"},className:M("h-full rounded-xl shadow-sm cursor-pointer",j.statsRight),onClick:m,children:[t(Zt,{progress:c}),g("div",{className:"flex justify-between px-6",children:[g("div",{className:M("flex flex-col rounded-lg text-center py-1 shadow-sm",j.amount),children:[t("span",{className:"text-3xl title-text",children:s}),t("span",{className:"text",children:"Todo"})]}),g("div",{className:M("flex flex-col rounded-lg text-center py-1 shadow-sm",j.amount),children:[t("span",{className:"text-3xl title-text",children:l}),t("span",{className:"text",children:"Done"})]})]})]})]}),t("div",{className:"mt-8",children:n.map(d=>t(Dr,{data:d},d.id))})]})]}),t("div",{className:j.rightSide,children:t(Ar,{})})]})},Qe=V([]),ht=V([]),sa=({visible:e,initialValues:a,onCancel:n,onSave:o,type:r="create",calendar:s,showKeepRef:l})=>{console.log("[faiz:] === initialValues",a);const[i,c]=S.exports.useState(!a?.isAllDay),{defaultDuration:m,projectList:d=[],journal:h}=B(),p=a?.calendarId==="Journal";let k=!d.some(({id:C})=>C===a?.calendarId)&&!p&&r==="update"?[h,{id:a?.calendarId,...Re},...d]:[h,...d];const[b]=y.useForm();return t(ce,{title:"Modify Schedule",visible:e,onOk:()=>{b.validateFields().then(async C=>{const{title:T,start:v,end:I,isAllDay:E,calendarId:H}=C;u(v).format("YYYY-MM-DD"),u(I).format("YYYY-MM-DD");const ae=u(v).format("HH:mm"),Ne=u(I).format("HH:mm"),fe=B();let ne=k.find(({id:_})=>_===H.value)?.id==="Journal"?"journal":"project";console.log("[faiz:] === newScheduleType",ne),console.log("[faiz:] === onClickSave",C);const se=ne==="journal";if(u(v).isAfter(u(I),E?"day":void 0))return logseq.App.showMsg("Start time cannot be later than end time","error");if(se&&!u(v).isSame(u(I),"day"))return logseq.App.showMsg("Journal schedule cannot span multiple days","error");let N=T;ne==="journal"?(r==="create"&&(N=E?`TODO ${T}`:`TODO ${ae}-${Ne} ${T}`),r==="update"&&(N=E?ct(a?.raw,T):ct(a?.raw,zt(T,ae,Ne)))):ne==="project"&&(r==="create"?N="TODO "+Gt(T,{start:v,end:I,allDay:E}):r==="update"&&(N=ct(a?.raw,Gt(T,{start:v,end:I,allDay:E}))));const q={},{preferredDateFormat:x}=await logseq.App.getUserConfigs();let P=a?.calendarId;if(se){const _=a?.start;_&&(P=G(_?.valueOf(),x))}let W=H.value;if(se){const _=G(v.valueOf(),x),L=await logseq.Editor.createPage(_,{},{journal:!0});L&&(W=L.originalName)}if(r==="create"){const _=logseq.settings?.logKey;let L;if(se?L=_?.enabled?await Vt(W,`[[${_?.id}]]`,N,q):await logseq.Editor.insertBlock(W,N,{isPageBlock:!0,sibling:!0,properties:q}):ne==="project"&&(L=await Vt(W,Ht,N)),!L)return logseq.App.showMsg("Create block failed","error");const Z=await logseq.Editor.getBlock(L.uuid),X=await ge(Z,fe),F=X?.addOns?.type==="milestone"?Fe(X):Ye(X);s?.createSchedules([F])}else if(W!==P){let _;const L=logseq.settings?.logKey;if(se?_=L?.enabled?await Pe(a?.id,W,`[[${L?.id}]]`):await dt(a?.id,W):ne==="project"&&(_=await Pe(a?.id,W,Ht)),await Le(_.uuid,N,q),Object.keys(q).length===0&&(await logseq.Editor.removeBlockProperty(_.uuid,"start"),await logseq.Editor.removeBlockProperty(_.uuid,"end")),_&&a?.calendarId){const Z=await logseq.Editor.getBlock(_.uuid);s?.deleteSchedule(a?.id,a.calendarId);const X=await ge(Z,fe),F=a?.raw?.addOns.type==="milestone"?Fe(X):Ye(X);s?.createSchedules([F])}}else{await Le(a?.id,N);const _=await logseq.Editor.getBlock(a?.id),L=await ge(_,fe),Z=a?.raw?.addOns.type==="task"?Ye(L):Fe(L);s?.updateSchedule(a?.id,a?.calendarId,Z)}o?.()})},onCancel:()=>{n?.()},children:g(y,{form:b,onValuesChange:(C,T)=>{C.isAllDay!==void 0&&c(!C.isAllDay),C.start!==void 0&&b.setFieldsValue({end:C.start.add(m.value,m.unit)})},initialValues:{isAllDay:!0,...a,calendarId:a?.calendarId?{value:a?.calendarId}:void 0},children:[t(y.Item,{name:"calendarId",label:"Project",rules:[{required:!0}],children:t(K,{labelInValue:!0,children:k.map(C=>g(K.Option,{value:C?.id,children:[t("span",{style:{width:"12px",height:"12px",display:"inline-block",backgroundColor:C?.bgColor,verticalAlign:"middle",marginRight:"5px",borderRadius:"4px"}}),C?.id]},C?.id))})}),t(y.Item,{name:"title",label:"Schedule Title",rules:[{required:!0}],children:t(z,{})}),t(y.Item,{name:"start",label:"Start",rules:[{required:!0}],children:t(Ot,{showTime:i?{format:"HH:mm"}:!1})}),t(y.Item,{name:"end",label:"End",rules:[{required:!0}],children:t(Ot,{showTime:i?{format:"HH:mm"}:!1})}),t(y.Item,{name:"isAllDay",label:"All Day",rules:[{required:!0}],children:g(U.Group,{children:[t(U,{value:!0,children:"Yes"}),t(U,{value:!1,children:"No"})]})})]})})},ft=({checked:e,color:a,indeterminate:n,onChange:o,children:r,...s})=>g("div",{onClick:()=>o?.(!e),...s,children:[t("span",{className:`check-box mr-2 ${e?"checked":""}`,style:{backgroundColor:a}}),r]}),Mr=({onShowCalendarChange:e,calendarList:a=[],subscriptionList:n=[]})=>{const[o,r]=S.exports.useState(["calendar","subscription"]),[s,l]=S.exports.useState(a.map(d=>d.id)?.concat(n?.map(d=>d.id))),i=(d,h)=>{let p=s.filter(w=>w!==d);h&&(p=s.concat(d)),l(p),e?.(p)},c=d=>{let h=[];d&&(h=a.map(p=>p.id)?.concat(n?.map(p=>p.id))),l(h),e?.(h)},m=d=>t("span",{className:"text text-xs",children:d});return g("div",{className:"sidebar pt-2 bg-quaternary",children:[g(re,{ghost:!0,expandIconPosition:"right",activeKey:o,expandIcon:({isActive:d})=>t("span",{className:"opacity-50",children:t(wa,{rotate:d?0:-90})}),onChange:d=>r(typeof d=="string"?[d]:d),children:[t(re.Panel,{header:m("Project"),children:a.map(d=>t(ft,{className:"mb-1 cursor-pointer flex items-center",color:d.bgColor,checked:s?.includes(d.id),onChange:h=>i(d.id,h),children:t(ye,{title:d.id,placement:"right",children:t("span",{className:"singlge-line-ellipsis flex-1",children:d.id})})},d.id))},"calendar"),n?.length>0&&t(re.Panel,{header:m("Subscription"),className:"mt-3",children:n.map(d=>t(ft,{className:"mb-1 cursor-pointer flex items-center",color:d.bgColor,checked:s?.includes(d.id),onChange:h=>i(d.id,h),children:t(ye,{title:d.id,placement:"right",children:t("span",{className:"singlge-line-ellipsis flex-1",children:d.id})})},d.id))},"subscription")]}),t(It,{className:"my-2"}),t("div",{style:{padding:"0 10px"},children:t(ft,{color:"#047857",checked:s?.length===a.length+n?.length,onChange:d=>c(d),children:t("span",{className:"cursor-pointer",children:"Check All"})})})]})},Or=({visible:e,onCancel:a,start:n,end:o,...r})=>{const[s,l]=S.exports.useState();return S.exports.useEffect(()=>{n&&o&&xn(n,o).then(i=>{l(i?.map(c=>c.content)?.join(`

`))})},[n,o]),t(ce,{...r,destroyOnClose:!0,title:"Weekly Logs",okText:"Copy And Close",visible:e,onCancel:a,onOk:()=>{Dn(s||""),a()},children:t(z.TextArea,{value:s,onChange:i=>l(i.target.value),rows:10})})},la=({schedules:e,isProjectCalendar:a=!0})=>{const{calendarList:n,subscriptionList:o,logKey:r,projectList:s=[],journal:l}=B(),[i,c]=S.exports.useState(),[m,d]=S.exports.useState(!0),[h,p]=S.exports.useState(logseq.settings?.defaultView||"month"),w=[l,...s],k=o?o?.filter(N=>N?.enabled):[],[b,f]=S.exports.useState({visible:!1,type:"create"});S.exports.useState({visible:!1,type:"create"});const[D,A]=S.exports.useState(Boolean(logseq.settings?.logKey?.enabled)&&logseq.settings?.defaultView==="week"),[C,T]=S.exports.useState({visible:!1}),v=S.exports.useRef(),I=()=>{if(v.current){const N=v.current.getDateRangeStart().getTime(),q=v.current.getDateRangeEnd().getTime();Da(N,q)?c(G(N,ie)):c(G(N,ie)+" ~ "+G(q,ie))}},E=N=>{p(N),N==="2week"?(v.current?.changeView("month"),v.current?.setOptions({month:{visibleWeeksCount:2}})):N==="month"?(v.current?.changeView("month"),v.current?.setOptions({month:{visibleWeeksCount:void 0}})):v.current?.changeView(N),I(),A(logseq.settings?.logKey?.enabled&&N==="week")},H=N=>{(w.concat(k)?.map(x=>x.id)).forEach(x=>{N.includes(x)?v.current?.toggleSchedules(x,!1):v.current?.toggleSchedules(x,!0)})},ae=()=>d(N=>!N),Ne=()=>{v.current?.today(),I()},fe=()=>{v.current?.prev(),I()},xt=()=>{v.current?.next(),I()},ne=async()=>{if(h==="day"&&i){const{preferredDateFormat:N}=await logseq.App.getUserConfigs(),q=G(Q(i,ie,new Date),N);logseq.App.pushState("page",{name:q}),logseq.hideMainUI()}},se=async()=>{const[N,q]=i?.split(" ~ ")||[];T({visible:!0,start:N,end:q})};return S.exports.useEffect(()=>{v.current&&(console.log("[faiz:] === schedules changed and refresh calendar",e),v.current.clear(),v.current.createSchedules(e))},[e,v.current]),S.exports.useEffect(()=>{window.requestAnimationFrame(async()=>{const N=await mn();console.log("[faiz:] === calendarOptions",N),v.current=new ka("#calendar",{...N}),I(),v.current.on("clickDayname",function(q){const x=v.current;x?.getViewName()==="week"&&(x.setDate(new Date(q.date)),x.changeView("day",!0),I(),p("day"))}),v.current.on("clickSchedule",function(q){document.querySelector("#faiz-nav-detail")?.addEventListener("click",async x=>{const P=q.schedule.raw||{},{id:W,originalName:_}=P?.page||{};let L=_;L||(L=(await logseq.Editor.getPage(W))?.originalName);const{uuid:Z}=await logseq.Editor.getBlock(P.id)||{uuid:""};logseq.Editor.scrollToBlockInPage(L,Z),logseq.hideMainUI()},{once:!0})}),v.current.on("beforeCreateSchedule",function(q){f({visible:!0,type:"create",values:{start:u(q.start),end:u(q.end),isAllDay:q.triggerEventName==="dblclick"}})}),v.current.on("beforeUpdateSchedule",async function(q){console.log("[faiz:] === beforeUpdateSchedule",q);const{schedule:x,changes:P,triggerEventName:W,start:_,end:L}=q;if(W==="click")f({visible:!0,type:"update",values:{id:x.id,start:u(x.start),end:u(x.end),isAllDay:x?.raw?.category!=="time",calendarId:x.calendarId,title:x.title,raw:x.raw}});else if(P){if(x.calendarId==="journal"&&!u(_).isSame(u(L),"day"))return logseq.App.showMsg("Journal schedule cannot span multiple days","error");let Z={},X={};if(Object.keys(P).forEach(F=>{x.isAllDay?Z[F]=u(P[F]).format("YYYY-MM-DD"):Z[F]=u(P[F]).format("YYYY-MM-DD HH:mm"),X[F]=u(P[F]).format()}),v.current?.updateSchedule(x.id,x.calendarId,P),x.calendarId==="journal"){const F=x?.raw?.marker,pa=x?.isAllDay?!1:`${F} `+zt(x?.raw?.content?.replace(new RegExp(`^${F} `),""),u(x?.start).format("HH:mm"),u(x?.end).format("HH:mm"));let Ve=x?.raw?.page?.journalDay;if(Ve||(Ve=(await te(x?.raw?.page?.id))?.journalDay),P.start&&!u(P.start).isSame(u(String(Ve),"YYYYMMDD"),"day")){console.log("[faiz:] === move journal schedule");const{preferredDateFormat:Dt}=await logseq.App.getUserConfigs(),St=G(u(P.start).valueOf(),Dt),At=logseq.settings?.logKey,Ke=At?.enabled?await Pe(x.raw?.id,St,`[[${At?.id}]]`):await dt(x.raw?.id,St);console.log("[faiz:] === newBlock",Ke,x,x?.id),Ke&&(v.current?.deleteSchedule(x.id,x.calendarId),v.current?.createSchedules([await je({...x,blockData:Ke,calendarConfig:n?.find(ga=>ga.id==="journal")})]))}else await Le(x.raw?.id,pa)}else await Le(x.id,!1,Z)}}),v.current.on("beforeDeleteSchedule",function(q){const{schedule:x}=q;ce.confirm({title:"Are you sure delete this schedule?",content:t("div",{className:"whitespace-pre-line",children:x.raw?.content}),onOk:async()=>{const P=await logseq.Editor.getBlock(x.raw?.id);if(!P)return logseq.App.showMsg("Block not found","error");logseq.Editor.removeBlock(P?.uuid),v.current?.deleteSchedule(x.id,x.calendarId)}})})})},[]),g("div",{className:"flex flex-col w-full h-full",children:[g("div",{className:"mb-2 flex items-center justify-between",children:[g("div",{className:"flex items-center",children:[!a&&t($,{className:"mr-2",onClick:ae,icon:m?t(ba,{}):t(va,{})}),t($,{className:"ml-2",shape:"circle",icon:t(Ca,{}),onClick:fe}),t($,{className:"ml-1",shape:"circle",icon:t(xa,{}),onClick:xt}),t($,{className:"ml-2",shape:"round",onClick:Ne,children:"Today"}),t(ye,{title:h==="day"?"Navigate to this journal note":"",children:t("span",{className:`ml-4 text-xl h-full items-center inline-block title-text ${h==="day"?"cursor-pointer":"cursor-auto"}`,style:{height:"34px",lineHeight:"34px"},onClick:ne,children:i})})]}),g("div",{children:[D&&t($,{className:"mr-4",onClick:se,children:"Export Weekly"}),t(U.Group,{options:Lt,value:h,defaultValue:logseq.settings?.defaultView||"month",onChange:N=>E(N.target.value),optionType:"button",buttonStyle:"solid"})]})]}),g("div",{className:"flex flex-1",children:[t("div",{className:`transition-all overflow-hidden bg-quaternary title-text mr-2 ${m?"w-0 mr-0":"w-40"}`,children:t(Mr,{onShowCalendarChange:H,calendarList:w,subscriptionList:k})}),t("div",{className:"flex-1 w-0",children:t("div",{id:"calendar",className:"h-full title-text"})})]}),t(Or,{visible:C.visible,start:C.start,end:C.end,onCancel:()=>T({visible:!1})}),b.visible?t(sa,{visible:b.visible,type:b.type,initialValues:b.values,calendar:v.current,onCancel:()=>{f({visible:!1}),v.current?.render()},onSave:()=>{f({visible:!1})}}):null]})},Ir="_container_1ypzn_1",Er="_sideBar_1ypzn_5";var qr={container:Ir,sideBar:Er};const _r=()=>{const[e]=O(mt),[a]=O(ht),[n,o]=S.exports.useState([]);return S.exports.useEffect(()=>{Nn().then(r=>{o(r)})},[]),console.log("[faiz:] === page calendar: internalSchedules",e),console.log("[faiz:] === page calendar: subscriptionSchedules",a),t("div",{className:"page-container flex",children:g("div",{className:M(qr.content,"flex flex-1 flex-col overflow-hidden p-8"),style:{maxWidth:"1400px"},children:[t("h1",{className:"title-text",children:"Calendar"}),t("div",{className:"bg-quaternary flex flex-col flex-1 rounded-2xl box-border p-6",children:t(la,{schedules:[...a,...e,...n],isProjectCalendar:!1})})]})})},jr="_contentWrapper_42y1q_1",Br="_timelineWrapper_42y1q_7";var yt={contentWrapper:jr,timelineWrapper:Br};const Lr=({project:e})=>{const[a,n]=S.exports.useState(!0),o=pe();return g("div",{className:M(yt.timelineWrapper,{[yt.expand]:a},"rounded-2xl mb-9 h-auto p-6 shadow"),children:[g("h3",{className:"title-text flex items-center cursor-pointer",onClick:()=>n(r=>!r),children:[e.title,a?t(Xe,{className:"ml-2"}):t(et,{className:"ml-2"})]}),t(Je,{children:a&&t(Ze.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"60vh"},exit:{opacity:0,height:0},transition:{ease:"easeInOut",duration:.2},children:t(Ge,{data:[e],weekStartDay:logseq.settings?.weekStartDay||0,theme:o,defaultMode:"advanced",uniqueId:lt()})})})]})},Pr=()=>{const[e]=O(ze),a=e||[];return g("div",{className:"page-container p-8 flex flex-col",children:[t("h1",{className:"title-text",children:"Gantt"}),t("div",{className:M(yt.contentWrapper),children:a.map(n=>t(Lr,{project:n}))})]})},Hr="_contentWrapper_42y1q_1",Rr="_timelineWrapper_42y1q_7";var wt={contentWrapper:Hr,timelineWrapper:Rr};const Yr=({project:e})=>{const[a,n]=S.exports.useState(!0),o=pe();return g("div",{className:M(wt.timelineWrapper,{[wt.expand]:a},"rounded-2xl mb-9 h-auto p-6 shadow"),children:[g("h3",{className:"title-text flex items-center cursor-pointer",onClick:()=>n(r=>!r),children:[e.title,a?t(Xe,{className:"ml-2"}):t(et,{className:"ml-2"})]}),t(Je,{children:a&&t(Ze.div,{className:"overflow-hidden",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{ease:"easeInOut",duration:.2},children:t(Ge,{data:[e],weekStartDay:logseq.settings?.weekStartDay||0,showSidebar:!1,theme:o,uniqueId:lt()})})})]})},Fr=()=>{const[e]=O(ze),a=e||[];return g("div",{className:"page-container p-8 flex flex-col",children:[t("h1",{className:"title-text",children:"Timeline"}),t("div",{className:M(wt.contentWrapper),children:a.map(n=>t(Yr,{project:n}))})]})},R=({value:e,onChange:a,text:n})=>{const[o,r]=S.exports.useState(!1);return g("div",{children:[t("span",{style:{backgroundColor:e},className:"px-2 py-1 rounded cursor-pointer shadow-md",onClick:()=>r(!0),children:n}),o&&g(de,{children:[t("div",{className:"bg-transparent fixed top-0 left-0 w-screen h-screen",onClick:()=>r(!1)}),t("div",{className:"fixed z-10 mt-2",children:t(Sa,{color:e,onChange:l=>{a?.(l.hex)}})})]})]})},$r=({visible:e,calendarId:a,initialValues:n,onCancel:o,onOk:r,...s})=>{const[l]=y.useForm(),i=()=>{const m=l.getFieldsValue(!0);r?.(m?.query)},c=async m=>{const d=l.getFieldsValue(!0)?.query[m];if(d){console.log(""),st(`[faiz:] === start exec your query:
`,"blue"),console.log(d?.script);try{let h;d?.queryType==="simple"?h=await logseq.DB.q(d?.script):h=await logseq.DB.datascriptQuery(d.script),st(`[faiz:] === exec your query success:
`,"green"),console.log(h)}catch(h){st(`[faiz:] === exec your query failed:
`,"red"),console.error(h)}console.log("")}};return t(ce,{...s,width:980,title:"Calendar Queries (saved searches)",visible:e,onCancel:o,onOk:i,children:t("div",{className:"overflow-y-auto overflow-x-hidden",style:{maxHeight:"500px"},children:t(y,{initialValues:{query:n},form:l,size:"small",children:t(y.List,{name:"query",children:(m,{add:d,remove:h})=>g(de,{children:[m.map((p,w)=>g("div",{className:"rounded border-dashed border-gray-200 px-4 pt-4 mb-3 relative",children:[t(y.Item,{label:`Query ${w+1}`,children:g(Et,{gutter:16,children:[t(tt,{span:12,children:t(y.Item,{label:"script",name:[p.name,"script"],labelCol:{span:4},children:t(z.TextArea,{rows:10})})}),g(tt,{span:12,children:[t(y.Item,{label:"Query Type",name:[p.name,"queryType"],labelCol:{span:7},children:g(U.Group,{children:[t(U,{value:"simple",children:"Simple Query"}),t(U,{value:"advanced",children:"Advanced Query"})]})}),t(y.Item,{label:"Schedule Start",name:[p.name,"scheduleStart"],labelCol:{span:7},children:t(z,{})}),t(y.Item,{label:"Schedule End",name:[p.name,"scheduleEnd"],labelCol:{span:7},children:t(z,{})}),t(y.Item,{label:"Date Formatter",name:[p.name,"dateFormatter"],labelCol:{span:7},children:t(z,{})}),t(y.Item,{label:"Is Milestone",name:[p.name,"isMilestone"],labelCol:{span:7},children:g(U.Group,{children:[t(U,{value:!0,children:"Yes"}),t(U,{value:!1,children:"No"})]})})]})]})}),g("div",{className:"absolute bottom-4 right-4",children:[t(ye,{title:"Execute this query in DevTools",children:t(Aa,{onClick:()=>c(w)})}),w!==0&&t(Me,{className:"ml-2",onClick:()=>h(p.name)})]})]},w)),t(y.Item,{children:t($,{type:"dashed",size:"small",onClick:()=>d(),block:!0,icon:t(Oe,{}),children:"Add Schedule Query"})})]})})})})})},ia=({value:e,onChange:a,calendarId:n})=>{const[o,r]=S.exports.useState(!1);return g("div",{children:[t(ye,{title:"Edit Calendar Queries",children:t($,{type:"link",icon:t(Ta,{}),onClick:()=>r(!0)})}),t($r,{visible:o,calendarId:n,initialValues:e,onCancel:()=>r(!1),onOk:s=>{a?.(s),r(!1)}})]})},zr=({visible:e,onCancel:a,onSave:n})=>{const[o]=y.useForm(),r=async s=>{const l=await te({originalName:s});if(console.log("[faiz:] === createAgendaPage getPage",l),l)return logseq.App.showMsg(`The page with the same name already exists
Please add properties to the page manually
agenda:: true`,"error"),{success:!0};const i=await logseq.Editor.createPage(s,{agenda:!0});return console.log("[faiz:] === createAgendaPage createPage",i),{success:!0}};return t(ce,{title:"Create Calendar",visible:e,onOk:()=>{o.validateFields().then(async s=>{const l=s.calendarId.trim();if(s.agenda){const{success:i}=await r(l);if(!i)return}n({name:l,agenda:Boolean(s.agenda)})})},onCancel:a,children:g(y,{form:o,children:[t(y.Item,{name:"calendarId",label:"Calendar ID",rules:[{required:!0}],children:t(z,{})}),t(y.Item,{name:"agenda",label:"Control By Agenda",tooltip:"Checking means that the plugin may modify this document",extra:"Not recommended, please use project instead",children:g(U.Group,{children:[t(U,{value:!0,children:"Yes"}),t(U,{value:!1,children:"No"})]})})]})})},Ur=V(B()),da=async(e,a)=>{if(!Array.isArray(e))return[];const n=e?.filter(i=>i?.enabled);if(!n?.length)return[];const r=(await Promise.allSettled(n.map(i=>Na(i.url)))).map(async(i,c)=>{if(i.status==="rejected")return logseq.App.showMsg(`Get Calendar ${n[c].id} data error
${i.reason}`,"error"),[];try{const m=Ma.parse(i.value.data),{events:d}=Wr(m),h=d.map(async p=>{const{dtstart:w,dtend:k,summary:b,description:f}=p,D=w.type==="date-time";return await je({blockData:{id:new Date().valueOf(),content:`${b?.value||"no summary"}
${f?.value||""}`,subscription:!0},category:D?"time":"allday",start:w.value,end:k?D?k?.value:ee(Oa(k?.value)):void 0,calendarConfig:n[c],defaultDuration:a,isAllDay:!D})});return Promise.all(h)}catch(m){return logseq.App.showMsg(`Parse Calendar ${n[c].id} data error
${m}`,"error"),console.log("[faiz:] === Parse Calendar error",m),[]}});return(await Promise.allSettled(r)).filter(i=>i?.status==="fulfilled").map(i=>i?.value)?.flat()},Wr=e=>{function a(l){return l.reduce((i,c)=>({...i,[c[0]]:{type:c[2],value:c[3]}}),{})}const[n,o,r]=e,s=r.filter(l=>l[0]==="vevent").map(l=>{const[i,c]=l;return a(c)});return{type:n,info:a(o),events:s}},Gr="_title_8pzto_1",Qr="_content_8pzto_4",Vr="_formBlock_8pzto_8",Kr="_show_8pzto_14",Jr="_tabs_8pzto_19",Zr="_tab_8pzto_19",Xr="_active_8pzto_27";var Y={title:Gr,content:Qr,formBlock:Vr,show:Kr,tabs:Jr,tab:Zr,active:Xr};const eo=({value:e,tabs:a,onChange:n})=>{const o=e;return t("div",{className:Y.tabs,children:a.map(({value:r,label:s})=>t("div",{className:M(Y.tab,{[Y.active]:o===r}),onClick:()=>n?.(r),children:s},r))})},ca=[{value:"basis",label:"Basis"},{value:"projects",label:"Project"},{value:"customCalendar",label:"Custom Calendar"},{value:"subscription",label:"Subscription"},{value:"calendarView",label:"Calendar View"}],to=({...e})=>{const[a]=Ia.useForm(),[n,o]=S.exports.useState(ca[0].value),[r,s]=S.exports.useState(!1),l=B();O(Qe);const[,i]=O(ht),[,c]=O(Ur),m=p=>{o(p)},d=({name:p,agenda:w=!1})=>{const k=[...a.getFieldValue("calendarList"),w?gn(p):pn(p)];a.setFieldsValue({calendarList:k}),s(!1),h({calendarList:k},a.getFieldsValue(!0))},h=(p,w)=>{console.log("[faiz:] === onValuesChange",p,w),c(w),logseq.updateSettings({calendarList:1,subscriptionList:1,projectList:1}),logseq.updateSettings({subscriptionList:[],projectList:[],...w}),setTimeout(async()=>{if((p?.lightThemeType||p.theme)&&Rt(),p?.calendarList,p?.subscriptionList){const{subscriptionList:k}=await B();i(await da(k))}},500)};return g("div",{className:"page-container p-8 flex flex-col items-center",children:[t("h1",{className:M(Y.title,"title-text"),children:"Settings"}),g("div",{className:M(Y.content,"rounded-2xl flex"),children:[g("div",{className:"flex flex-col justify-between pr-5",children:[t(eo,{value:n,tabs:ca,onChange:m}),t(Ea,{title:g("span",{children:["Are you sure you want to restore default settings?",t("br",{}),"This is an irreversible operation."]}),onConfirm:()=>{a.setFieldsValue(J),h(J,J)},children:t($,{className:"text-left",type:"link",style:{color:"var(--ls-tertiary-background-color)"},children:"Restore Defaults"})})]}),g(y,{initialValues:l,labelCol:{span:4},preserve:!0,form:a,style:{maxWidth:"800px",width:"80%"},onValuesChange:h,className:"relative h-full",children:[g("div",{id:"basis",className:M(Y.formBlock,{[Y.show]:n==="basis"}),children:[t(y.Item,{label:"Theme",name:"theme",children:t(K,{options:sn})}),t(y.Item,{label:"Light Theme Type",name:"lightThemeType",children:t(K,{options:ln})}),t(y.Item,{label:"Home Page",name:"homePage",children:t(K,{options:Te})}),t(y.Item,{label:"Default Duration",name:["defaultDuration","value"],children:t(at,{addonAfter:t(y.Item,{name:["defaultDuration","unit"],noStyle:!0,children:t(K,{style:{width:80},options:cn})})})}),t(y.Item,{label:"Log Key",required:!0,children:g("div",{className:"flex items-center justify-between",children:[t(y.Item,{noStyle:!0,name:["logKey","id"],rules:[{required:!0}],children:t(z,{style:{width:"240px"}})}),t(y.Item,{name:["logKey","bgColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"background"})}),t(y.Item,{name:["logKey","textColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"text"})}),t(y.Item,{name:["logKey","borderColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"border"})}),t(y.Item,{name:["logKey","enabled"],noStyle:!0,valuePropName:"checked",children:t(we,{})})]})}),t(y.Item,{label:"Journal",required:!0,children:g("div",{className:"flex items-center justify-between",children:[t(y.Item,{noStyle:!0,name:["journal","id"],rules:[{required:!0}],children:t(z,{style:{width:"240px"},disabled:!0})}),t(y.Item,{name:["journal","bgColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"background"})}),t(y.Item,{name:["journal","textColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"text"})}),t(y.Item,{name:["journal","borderColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"border"})}),t(y.Item,{name:["journal","query"],rules:[{required:!0}],style:{display:"none"},children:t(ia,{calendarId:"query"})}),t(y.Item,{name:["journal","enabled"],noStyle:!0,valuePropName:"checked",children:t(we,{})})]})})]}),t("div",{id:"projects",className:M(Y.formBlock,{[Y.show]:n==="projects"}),children:t(y.List,{name:"projectList",children:(p,{add:w,remove:k,move:b})=>t(de,{children:t(qt,{onDragEnd:f=>{console.log("[faiz:] === onDragEnd",f),f?.destination&&b(f.source.index,f.destination.index)},children:t(_t,{droppableId:"droppable-projects",children:(f,D)=>g("div",{ref:f.innerRef,children:[p.map((A,C)=>t(jt,{draggableId:`drag ${C}`,index:C,children:(T,v)=>t("div",{ref:T.innerRef,...T.draggableProps,...T.dragHandleProps,children:t(y.Item,{children:g("div",{className:"flex items-center justify-between",children:[t(y.Item,{name:[A.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(z,{placeholder:"Project ID (Page Name)",style:{width:"300px"}})}),t(y.Item,{name:[A.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"background"})}),t(y.Item,{name:[A.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"text"})}),t(y.Item,{name:[A.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"border"})}),t(y.Item,{name:[A.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(we,{})}),t(Me,{onClick:()=>k(A.name)})]})})})},C)),t(y.Item,{children:t($,{type:"dashed",onClick:()=>w({id:void 0,bgColor:"#b8e986",textColor:"#4a4a4a",borderColor:"#047857",enabled:!0}),block:!0,icon:t(Oe,{}),children:"Add Project"})})]})})})})})}),g("div",{id:"customCalendar",className:M(Y.formBlock,{[Y.show]:n==="customCalendar"}),children:[t(qa,{message:"Do not use this setting unless you need to write your own Query to get the calendar.",type:"warning",className:"mb-6"}),t(y.List,{name:"calendarList",children:(p,{add:w,remove:k,move:b})=>t(de,{children:t(qt,{onDragEnd:f=>{console.log("[faiz:] === onDragEnd",f),!(f?.destination?.index===0||f?.source?.index===0)&&f?.destination&&b(f.source.index,f.destination.index)},children:t(_t,{droppableId:"droppable-1",children:(f,D)=>g("div",{ref:f.innerRef,children:[p.map((A,C)=>t(jt,{draggableId:`drag ${C}`,index:C,children:(T,v)=>t("div",{ref:T.innerRef,...T.draggableProps,...T.dragHandleProps,children:t(y.Item,{children:g("div",{className:"flex items-center justify-between",children:[t(y.Item,{name:[A.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(z,{placeholder:"Calendar ID",style:{width:"300px"}})}),t(y.Item,{name:[A.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"background"})}),t(y.Item,{name:[A.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"text"})}),t(y.Item,{name:[A.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"border"})}),t(y.Item,{name:[A.name,"query"],noStyle:!0,rules:[{required:!0}],children:t(ia,{calendarId:"query"})}),t(y.Item,{name:[A.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(we,{})}),t(Me,{onClick:()=>k(A.name)})]})})})},C)),t(y.Item,{children:t($,{type:"dashed",onClick:()=>s(!0),block:!0,icon:t(Oe,{}),children:"Add Custom Calendar"})})]})})})})})]}),t("div",{id:"subscription",className:M(Y.formBlock,{[Y.show]:n==="subscription"}),children:t(y.List,{name:"subscriptionList",children:(p,{add:w,remove:k})=>g(de,{children:[p.map((b,f)=>t(y.Item,{label:f===0?"Subscription":"",...f===0?{}:{wrapperCol:{offset:4}},children:g("div",{className:"flex items-center justify-between",children:[t(y.Item,{name:[b.name,"id"],noStyle:!0,rules:[{required:!0}],children:t(z,{placeholder:"Calendar ID",style:{width:"160px"}})}),t(y.Item,{name:[b.name,"url"],noStyle:!0,rules:[{required:!0,type:"url"}],children:t(z,{placeholder:"Url",style:{width:"100px"}})}),t(y.Item,{name:[b.name,"bgColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"background"})}),t(y.Item,{name:[b.name,"textColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"text"})}),t(y.Item,{name:[b.name,"borderColor"],noStyle:!0,rules:[{required:!0}],children:t(R,{text:"border"})}),t(y.Item,{name:[b.name,"enabled"],noStyle:!0,valuePropName:"checked",children:t(we,{})}),t(Me,{onClick:()=>k(b.name)})]})})),t(y.Item,{wrapperCol:{offset:4},children:t($,{type:"dashed",onClick:()=>w(),block:!0,icon:t(Oe,{}),children:"Add Subscription"})})]})})}),g("div",{id:"calendar",className:M(Y.formBlock,{[Y.show]:n==="calendarView"}),children:[t(y.Item,{label:"Default View",name:"defaultView",rules:[{required:!0}],children:t(K,{options:Lt})}),t(y.Item,{label:"Week Start Day",name:"weekStartDay",rules:[{required:!0}],children:g(K,{children:[t(K.Option,{value:0,children:"Sunday"}),t(K.Option,{value:1,children:"Monday"})]})}),t(y.Item,{label:"Time Grid",children:g("div",{className:"flex items-center",children:[t(y.Item,{noStyle:!0,name:"weekHourStart",children:t(at,{min:0,max:24})}),t("span",{className:"px-2",children:"-"}),t(y.Item,{noStyle:!0,name:"weekHourEnd",children:t(at,{min:0,max:24})})]})})]})]})]}),t(zr,{visible:r,onSave:d,onCancel:()=>s(!1)})]})},Te=[{label:"Dashboard",value:"dashboard",icon:t(_a,{}),path:"/dashboard",element:t(Nr,{})},{label:"Calendar",value:"calendar",icon:t(ja,{}),path:"/calendar",element:t(_r,{})},{label:"Gantt",value:"gantt",icon:t(Ba,{}),path:"/gantt",element:t(Pr,{})},{label:"Timeline",value:"timeline",icon:t(La,{}),path:"/timeline",element:t(Fr,{})},{label:"Settings",value:"settings",icon:t(Pa,{}),path:"/settings",element:t(to,{})}],ao="_container_1ph2e_1",no="_logo_1ph2e_6",ro="_close_1ph2e_16";var kt={container:ao,logo:no,close:ro};const oo=({defaultRoute:e})=>{const a=Mt(),{homePage:n=J.homePage}=B(),o=r=>{const{path:s}=Te.find(l=>l.value===r)||{path:"/"};a(s)};return S.exports.useEffect(()=>{e&&a(e)},[e]),g("div",{className:kt.container,children:[t("div",{className:kt.logo,children:t("img",{src:hn})}),t(Cn,{tabs:Te,onChange:o,initialValue:n}),t("div",{className:kt.close,onClick:()=>logseq.hideMainUI(),children:t(Ha,{})})]})},ua=({projectId:e,mode:a})=>{const[n]=O(ze),o=n?.find(s=>s.id===e),r=pe();return o?t(Ge,{data:[o],weekStartDay:logseq.settings?.weekStartDay||0,theme:r,defaultMode:a,uniqueId:lt()}):null},so="_page_1ia39_1",lo="_border_1ia39_9",io="_linkText_1ia39_12";var bt={page:so,border:lo,linkText:io};const co=({upcomingList:e,waitingList:a,doneList:n,canceledList:o,onSelect:r,value:s})=>{const l=i=>t(ke.Item,{onClick:()=>r(i),className:M("cursor-pointer px-2 rounded",{"bg-quinary":i.id+""===s}),children:g("div",{className:"flex justify-between w-full",children:[t("span",{children:i.addOns.showTitle}),i.rawTime&&t("span",{className:M(bt.linkText,"whitespace-nowrap"),children:u(i.addOns.start).format("MM-DD")})]})});return t("div",{className:"w-full h-full",children:g(re,{ghost:!0,defaultActiveKey:["upcoming","waiting"],children:[t(re.Panel,{header:g("span",{children:[t("b",{children:"Upcoming"}),t("span",{className:"ml-2 description-text",children:e.length})]}),children:t(ke,{dataSource:e,renderItem:l})},"upcoming"),t(re.Panel,{header:g("span",{children:[t("b",{children:"Waiting"}),t("span",{className:"ml-2 description-text",children:a.length})]}),children:t(ke,{dataSource:a,renderItem:l})},"upcoming"),t(re.Panel,{header:g("span",{children:[t("b",{children:"Done"}),t("span",{className:"ml-2 description-text",children:n.length})]}),children:t(ke,{dataSource:n,renderItem:l})},"done"),t(re.Panel,{header:g("span",{children:[t("b",{children:"Canceled"}),t("span",{className:"ml-2 description-text",children:o.length})]}),children:t(ke,{dataSource:o,renderItem:l})},"canceled")]})})},uo=({projectId:e})=>{const[a,n]=S.exports.useState(),[o]=O(Se),[r]=O(Ae),s=e==="Journal"?o:r.get(e),l=Ce(s?.tasks?.noTime||[]),i=Ce(s?.tasks?.withTime||[]),c=[...i.doing,...i.todo,...l.doing,...l.todo],m=[...i.done,...l.done],d=[...i.canceled,...l.canceled],h=[...i.waiting,...l.waiting],p=async w=>{logseq.Editor.scrollToBlockInPage(e,w),logseq.hideMainUI()};return g("div",{className:"w-full h-full flex",children:[t("div",{className:M("w-1/2 overflow-auto",bt.border),children:t(co,{waitingList:h,upcomingList:c,doneList:m,canceledList:d,onSelect:n,value:a?.id+""})}),t("div",{className:"w-1/2 overflow-auto",children:a&&g("div",{className:"pl-4",children:[t("h3",{children:a.addOns.showTitle}),t("p",{className:"whitespace-pre-line",children:a.content}),t($,{type:"link",className:"px-0",onClick:()=>p(a.uuid),children:"Navigate To Block"})]})})]})},mo=()=>{const{projectId:e=""}=Ra(),a=decodeURIComponent(e),[n]=O($n),[o]=O(zn),r=a==="Journal"?n?.schedules:o.find(s=>s?.calendarConfig?.id===a)?.schedules||[];return g("div",{className:M(bt.page,"page-container p-8 flex flex-col items-center"),children:[t("h1",{className:"title-text w-full",children:a}),t("div",{className:"rounded-2xl flex w-full h-full p-6 bg-quaternary",children:a&&g(be,{className:"w-full",tabPosition:"left",children:[t(be.TabPane,{tab:"List",children:t(uo,{projectId:a})},"list"),t(be.TabPane,{tab:"Calendar",children:t(la,{schedules:r,isProjectCalendar:!0})},"calendar"),t(be.TabPane,{tab:"Gantt",children:t(ua,{projectId:a,mode:"advanced"})},"gantt"),t(be.TabPane,{tab:"Timeline",children:t(ua,{projectId:a,mode:"simple"})},"timeline")]})})]})},po=({defaultRoute:e})=>{O(Qe);const[,a]=O(ht),[,n]=O(he),[,o]=O(Se),[,r]=O(Ae),{homePage:s=J.homePage}=B(),l=Te.find(i=>i.value===s)?.element;return S.exports.useEffect(()=>{async function i(){const c=await ut();if(console.log("[faiz:] === res",c),c){const{fullEvents:d,journalEvents:h,projectEventsMap:p}=c;n(d),o(h),r(p)}const{subscriptionList:m}=B();a(await da(m))}i()},[]),t("main",{className:"w-screen h-screen flex",prefix:"custom",children:g(Ya,{children:[t(oo,{defaultRoute:e}),g(Fa,{children:[t(nt,{path:"/",element:l}),Te.map(i=>t(nt,{path:i.path,element:i.element},i.value)),t(nt,{path:"/project/:projectId",element:t(mo,{})})]})]})})};const go=({visible:e,uuid:a,onSave:n,onCancel:o})=>{const[r,s]=S.exports.useState(!1),[l]=O($e),i=l.map(p=>({label:p.addOns.showTitle,value:p.uuid})),[c,m]=S.exports.useState([]),d=()=>{i.length===c.length?m([]):m(i.map(p=>p.value))},h=async()=>{let p=[];for(let w=0;w<c.length;w++){const k=await me({uuid:c[w]?.replace("overdue-","")});p.push(k)}logseq.Editor.insertBatchBlock(a,p.map(w=>({content:`((${w?.uuid}))`})),{before:!1,sibling:!0}),n()};return S.exports.useEffect(()=>{c?.length>0&&c.length<i.length?s(!0):s(!1)},[c?.length,i?.length]),console.log("[faiz:] === options",i,l,a),g(ce,{visible:e,title:"Insert Today Task",onCancel:o,onOk:h,children:[t(rt.Group,{value:c,onChange:p=>m(p),children:i.map((p,w)=>t(Et,{children:t(tt,{span:24,children:t(rt,{value:p.value,children:p.label},p.value)})}))}),t(It,{}),t(rt,{indeterminate:r,checked:i.length===c.length,onClick:d,children:"Check All"})]})},ho=e=>{O(Qe);const[,a]=O(he),[,n]=O(Se),[,o]=O(Ae),r=e.type,s=()=>{logseq.hideMainUI()},l=()=>{logseq.hideMainUI()};return S.exports.useEffect(()=>{async function i(){const c=await ut();if(c){const{fullEvents:m,journalEvents:d,projectEventsMap:h}=c;a(m),n(d),o(h)}}r==="insertTodaySchedule"&&i()},[r]),g("div",{className:"w-screen h-screen",children:[r==="editSchedule"&&t(sa,{visible:!0,showKeepRef:e.showKeepRef,type:e.data.type,initialValues:e.data.initialValues,onSave:s,onCancel:l}),r==="insertTodaySchedule"&&t(go,{visible:!0,uuid:e.data.uuid,onSave:s,onCancel:l})]})};function fo(e,a=!1){const n=e?.addOns.start,o=e?.addOns.end,r=u(n),s=u(o),l=r.isSame(s,"day");return a?e.addOns.allDay?l?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:l&&r.isSame(u(),"day")?{start:r.format("HH:mm"),end:s.format("HH:mm")}:l?{start:r.format("MM-DD")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}:l?e.addOns.allDay?{start:"all-day"}:{start:r.format("HH:mm"),end:s.format("HH:mm")}:{start:r.format("MM-DD"),end:s.format("MM-DD")}}const vt=({task:e,type:a="allDay"})=>{const n=u(e.addOns.start),o=u(e.addOns.end),r=a==="time"&&u().isBetween(n,o),s=e.addOns.status==="done",l=e.addOns.calendarConfig,{start:i,end:c}=fo(e,a==="overdue"),m=async()=>{const{id:h,originalName:p}=e?.page||{};let w=p;w||(w=(await te({id:h}))?.originalName),logseq.Editor.scrollToBlockInPage(w,e.uuid)},d=async h=>{console.log("[faiz:] === embedToToday",e),h.stopPropagation();const p=e.uuid,{preferredDateFormat:w}=await logseq.App.getUserConfigs(),k=G(u().valueOf(),w),b=logseq.settings?.logKey,f=await logseq.Editor.insertBlock(p,`((${p}))`+(l?.id?.toLocaleLowerCase()==="journal"?"":` #[[${l?.id}]]`),{before:!1,sibling:!0});b?.enabled?await Pe(f?.uuid,k,`[[${b?.id}]]`):await dt(f?.uuid,k),logseq.Editor.scrollToBlockInPage(k,f?.uuid),logseq.UI.showMsg("Embed task to today success","success")};return g("div",{className:"agenda-sidebar-task flex cursor-pointer",style:{margin:"10px 0",opacity:s?.4:.9},onClick:m,children:[g("div",{className:"flex flex-col justify-between text-right",style:{color:a==="overdue"?"#ed4245":"var(--ls-icon-color)",fontSize:"0.8em",width:"50px"},children:[t("div",{className:"w-full",children:i}),c&&t("div",{className:"w-full",style:{opacity:.6},children:c})]}),t("div",{style:{width:"4px",backgroundColor:l?.bgColor,borderRadius:"2px",margin:"0 6px"}}),g("div",{style:{width:"calc(100% - 90px)",paddingBottom:"24px",position:"relative"},children:[t("div",{style:{color:"var(--ls-icon-color)",fontSize:"0.8em",opacity:.6},children:l?.id}),t("div",{className:"agenda-sidebar-task__title",style:{marginBottom:"-0.2em",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",position:"absolute",bottom:0,width:"calc(100% - 30px)"},title:e.addOns.showTitle,children:e.addOns.showTitle}),r&&t("span",{className:"ui__button bg-indigo-600",style:{fontSize:"0.5em",position:"absolute",right:0,bottom:0,padding:"0 3px",borderRadius:"3px"},children:"NOW"})]}),t("div",{onClick:d,className:"agenda-sidebar-task__add flex",style:{alignItems:"center",paddingLeft:"8px"},children:t($a,{style:{color:"var(--ls-icon-color)",fontSize:"0.9em",opacity:"0.7",marginTop:"0.2em"}})})]})},yo=({containerId:e})=>{O(Qe);const[a]=O($e),{overdueTasks:n,allDayTasks:o,timeTasks:r}=Qt(a),[,s]=O(he),[,l]=O(Se),[,i]=O(Ae);return S.exports.useEffect(()=>{async function c(){const m=await ut();if(m){const{fullEvents:d,journalEvents:h,projectEventsMap:p}=m;s(d),l(h),i(p)}}c(),logseq.DB.onChanged(({blocks:m,txData:d,txMeta:h})=>{d?.some(p=>p?.[1]==="marker")&&parent.document.querySelector("#"+e)&&c()})},[]),g("main",{children:[n?.length===0&&o?.length===0&&r?.length===0&&t("div",{children:"Empty task list"}),n.length>0&&t("div",{style:{margin:"8px 0"},children:n.map(c=>t(vt,{task:c,type:"overdue"},c.id))}),o.length>0&&t("div",{children:o.map(c=>t(vt,{task:c,type:"allDay"},c.id))}),r.length>0&&t("div",{children:r.map(c=>t(vt,{task:c,type:"time"},c.id))})]})};u.extend(za);u.extend(Ua);u.extend(Wa);u.extend(Ga);u.extend(Qa);u.extend(Va);Ka([Ja,Za,Xa,en,tn,an,nn]);console.log("=== logseq-plugin-agenda loaded ==="),logseq.ready(()=>{un(),Rt(),logseq.App.getUserConfigs().then(a=>{window.logseqAppUserConfigs=a}),Sn(()=>logseq.hideMainUI()),logseq.App.onThemeModeChanged(({mode:a})=>{_e(a)}),logseq.on("ui:visible:changed",a=>{a.visible||Ie.unmountComponentAtNode(document.getElementById("root"))}),logseq.provideModel({show(){ma(),logseq.showMainUI()}}),logseq.App.registerUIItem("toolbar",{key:"logseq-plugin-agenda",template:'<a data-on-click="show" class="button"><i class="ti ti-comet"></i></a>'}),logseq.App.registerCommandPalette({key:"logseq-plugin-agenda:show",label:"Show Agenda"},a=>{ma(),logseq.showMainUI()});const e=async a=>{let n=await logseq.Editor.getBlock(a.uuid);const o=await Promise.all(n.refs?.map(s=>logseq.Editor.getPage(s.id)));n.refs=o;const r=await ge(n,B());Ct({type:"editSchedule",data:{type:"update",initialValues:{id:r.uuid,start:u(r.addOns.start),end:u(r.addOns.end),isAllDay:r.addOns.allDay,calendarId:r.addOns.calendarConfig?.id,title:r.addOns.showTitle,raw:r}},showKeepRef:!0}),logseq.showMainUI()};logseq.Editor.registerBlockContextMenuItem("Agenda: Modify Schedule",e),logseq.Editor.registerSlashCommand("Agenda: Modify Schedule",e),logseq.Editor.registerSlashCommand("Agenda: Insert Today's Task",a=>(console.log("[faiz:] === registerSlashCommand",a),Ct({type:"insertTodaySchedule",data:{uuid:a.uuid}}),logseq.showMainUI(),Promise.resolve())),logseq.Editor.registerSlashCommand("Agenda: Insert Task List",async()=>{logseq.Editor.insertAtEditingCursor("{{renderer agenda, task-list}}")}),logseq.App.onMacroRendererSlotted(async({slot:a,payload:{arguments:n,uuid:o}})=>{if(console.log("[faiz:] === onMacroRendererSlotted",a,n,o),n?.[0]!=="agenda"||n?.[1]!=="task-list")return;const r=parent.document.getElementById(a)?.childElementCount;if(console.log("[faiz:] === is renderered",r),r)return;const s=`agenda-task-list-${a}`;logseq.provideUI({key:`agenda-${a}`,slot:a,reset:!0,template:`<div id="${s}"></div>`}),logseq.provideStyle(`${Xt}
        #block-content-${o} .lsp-hook-ui-slot {
          width: 100%;
        }
        #block-content-${o} .lsp-hook-ui-slot > div {
          width: 100%;
        }
        #block-content-${o} .lsp-hook-ui-slot > div > div {
          width: 100%;
        }
      `),setTimeout(()=>{Ie.render(t(ot.StrictMode,{children:t(yo,{containerId:s})}),parent.document.getElementById(s))},0)}),logseq.provideStyle(Xt),top&&top.document.addEventListener("click",async a=>{const n=a.composedPath(),o=n[0];if(o.tagName==="A"&&o.className.includes("external-link")&&o.getAttribute("href")?.startsWith("#agenda://")){const r=Ln(n);if(!r)return;const s=await logseq.Editor.getBlock(r),l=await logseq.Editor.getPage(s.page?.id),i=await ge(s,B());Ct({type:"editSchedule",data:{type:"update",initialValues:{id:r,title:i.addOns.showTitle,calendarId:l?.originalName,keepRef:!1,start:u(i.addOns.start),end:u(i.addOns.end),isAllDay:i.addOns.allDay,raw:i}}}),logseq.showMainUI()}})});async function ma(e){Ft(!1);let a="";const n=await logseq.Editor.getCurrentPage(),{projectList:o=[]}=B();(Bn(n?.originalName)||o.some(r=>r.id===n?.originalName))&&(a=`project/${encodeURIComponent(n?.originalName)}`),Ie.render(t(ot.StrictMode,{children:t(po,{defaultRoute:a})}),document.getElementById("root"))}function Ct(e){const{type:a,data:n}=e;Ft(!0),Ie.render(t(ot.StrictMode,{children:t(ho,{type:a,data:n,showKeepRef:e.showKeepRef})}),document.getElementById("root"))}
